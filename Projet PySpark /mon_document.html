<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Audric Girondin">

<title>Projet Big Data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="mon_document_files/libs/clipboard/clipboard.min.js"></script>
<script src="mon_document_files/libs/quarto-html/quarto.js"></script>
<script src="mon_document_files/libs/quarto-html/popper.min.js"></script>
<script src="mon_document_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="mon_document_files/libs/quarto-html/anchor.min.js"></script>
<link href="mon_document_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="mon_document_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="mon_document_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="mon_document_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="mon_document_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script type="text/javascript">
window.PlotlyConfig = {MathJaxConfig: 'local'};
if (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) {window.MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}
if (typeof require !== 'undefined') {
require.undef("plotly");
requirejs.config({
    paths: {
        'plotly': ['https://cdn.plot.ly/plotly-2.35.0.min']
    }
});
require(['plotly'], function(Plotly) {
    window._Plotly = Plotly;
});
}
</script>



</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#configuration" id="toc-configuration" class="nav-link" data-scroll-target="#configuration">Configuration</a></li>
  <li><a href="#importation-des-librairies" id="toc-importation-des-librairies" class="nav-link" data-scroll-target="#importation-des-librairies">Importation des librairies</a></li>
  <li><a href="#chargement-des-données" id="toc-chargement-des-données" class="nav-link" data-scroll-target="#chargement-des-données">Chargement des données</a></li>
  <li><a href="#nettoyage-des-données" id="toc-nettoyage-des-données" class="nav-link" data-scroll-target="#nettoyage-des-données">Nettoyage des données</a></li>
  <li><a href="#analyse-descriptive" id="toc-analyse-descriptive" class="nav-link" data-scroll-target="#analyse-descriptive">Analyse Descriptive</a>
  <ul class="collapse">
  <li><a href="#les-10-produits-les-plus-vendus" id="toc-les-10-produits-les-plus-vendus" class="nav-link" data-scroll-target="#les-10-produits-les-plus-vendus">Les 10 produits les plus vendus</a></li>
  <li><a href="#les-10-produits-les-plus-rentables" id="toc-les-10-produits-les-plus-rentables" class="nav-link" data-scroll-target="#les-10-produits-les-plus-rentables">Les 10 produits les plus rentables</a></li>
  <li><a href="#tendance-des-ventes-mensuelles" id="toc-tendance-des-ventes-mensuelles" class="nav-link" data-scroll-target="#tendance-des-ventes-mensuelles">Tendance des ventes mensuelles</a></li>
  <li><a href="#chiffre-daffaires-des-5-principaux-produits-dans-différentes-villes" id="toc-chiffre-daffaires-des-5-principaux-produits-dans-différentes-villes" class="nav-link" data-scroll-target="#chiffre-daffaires-des-5-principaux-produits-dans-différentes-villes">Chiffre d’affaires des 5 principaux produits dans différentes villes</a></li>
  <li><a href="#analyse-en-composantes-principales-acp" id="toc-analyse-en-composantes-principales-acp" class="nav-link" data-scroll-target="#analyse-en-composantes-principales-acp">Analyse en Composantes Principales (ACP)</a></li>
  </ul></li>
  <li><a href="#tests-statistiques" id="toc-tests-statistiques" class="nav-link" data-scroll-target="#tests-statistiques">Tests statistiques</a>
  <ul class="collapse">
  <li><a href="#matrice-de-corrélation" id="toc-matrice-de-corrélation" class="nav-link" data-scroll-target="#matrice-de-corrélation">Matrice de corrélation</a></li>
  </ul></li>
  <li><a href="#test-du-chi-deux" id="toc-test-du-chi-deux" class="nav-link" data-scroll-target="#test-du-chi-deux">Test du Chi-deux</a></li>
  <li><a href="#machine-learning" id="toc-machine-learning" class="nav-link" data-scroll-target="#machine-learning">Machine Learning</a>
  <ul class="collapse">
  <li><a href="#clustering" id="toc-clustering" class="nav-link" data-scroll-target="#clustering">Clustering</a></li>
  </ul></li>
  <li><a href="#flux-de-données-en-temps-réel" id="toc-flux-de-données-en-temps-réel" class="nav-link" data-scroll-target="#flux-de-données-en-temps-réel">Flux de données en temps réel</a>
  <ul class="collapse">
  <li><a href="#serveur-socket" id="toc-serveur-socket" class="nav-link" data-scroll-target="#serveur-socket">Serveur Socket</a></li>
  <li><a href="#traitement-des-données-en-temps-réel" id="toc-traitement-des-données-en-temps-réel" class="nav-link" data-scroll-target="#traitement-des-données-en-temps-réel">Traitement des données en temps réel</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Projet Big Data</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Audric Girondin </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Dans un contexte économique de plus en plus compétitif, la capacité d’une entreprise à analyser et exploiter efficacement ses données de vente est cruciale pour maintenir sa position sur le marché. Ce projet s’inscrit dans une démarche d’exploration des ventes d’une entreprise spécialisée dans l’électronique, en utilisant un ensemble de <a href="https://www.kaggle.com/datasets/darkovichcycy/bd-sales?resource=download&amp;select=Sales_August_2019.csv">données</a> provenant de Kaggle. L’objectif principal est d’identifier les produits les plus performants, d’analyser les tendances de vente, et de comprendre les facteurs influençant les revenus.</p>
<p>Ce travail est réalisé dans le cadre de mon cours de Big Data, où j’apprends à gérer et analyser des données massives. L’utilisation de PySpark dans ce projet me permet de manipuler efficacement de grands volumes de données, ce qui est essentiel dans le traitement des données à grande échelle. Le projet comprend plusieurs étapes : le nettoyage des données, des analyses descriptives, des tests statistiques, du machine learning et le traitement de flux. En particulier, le test du Chi-deux a été utilisée pour évaluer s’il y a une dépendance entre la ville et le produit choisi, tandis que le clustering via KMEANS a permis de regrouper certains produits. Sans oublier le traitement des données en flux avec PySpark Streaming, qui permet une analyse en temps réel des données.</p>
</section>
<section id="configuration" class="level2">
<h2 class="anchored" data-anchor-id="configuration">Configuration</h2>
<div id="8c67d2c0" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#install pyspark</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">#!pip install pyspark</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Spark SQL</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">#!pip install pyspark[sql]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="b9184a86" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#import google drive</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">#from google.colab import drive</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">#drive.mount('/content/drive/')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="6774a82a" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import SparkSession</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql <span class="im">import</span> SparkSession</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a Spark Session</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>spark <span class="op">=</span> SparkSession.builder.master(<span class="st">"local[*]"</span>).getOrCreate()</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Check Spark Session Information</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>spark</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>25/01/10 17:28:17 WARN Utils: Your hostname, MacBook-Pro-dAudric.local resolves to a loopback address: 127.0.0.1; using 192.168.1.31 instead (on interface en0)
25/01/10 17:28:17 WARN Utils: Set SPARK_LOCAL_IP if you need to bind to another address
Setting default log level to "WARN".
To adjust logging level use sc.setLogLevel(newLevel). For SparkR, use setLogLevel(newLevel).
25/01/10 17:28:18 WARN NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="3">

            <div>
                <p><b>SparkSession - in-memory</b></p>
                
        <div>
            <p><b>SparkContext</b></p>

            <p><a href="http://192.168.1.31:4040">Spark UI</a></p>

            <dl>
              <dt>Version</dt>
                <dd><code>v3.5.2</code></dd>
              <dt>Master</dt>
                <dd><code>local[*]</code></dd>
              <dt>AppName</dt>
                <dd><code>pyspark-shell</code></dd>
            </dl>
        </div>
        
            </div>
        
</div>
</div>
</section>
<section id="importation-des-librairies" class="level2">
<h2 class="anchored" data-anchor-id="importation-des-librairies">Importation des librairies</h2>
<div id="104fa87b" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql <span class="im">import</span> SparkSession</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql.functions <span class="im">import</span> udf, col, <span class="bu">sum</span>, count, to_date, month, year, split, mean,explode, split, current_timestamp, window, pandas_udf</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql.types <span class="im">import</span> StringType, IntegerType</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql <span class="im">import</span> Row</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql <span class="im">import</span> functions <span class="im">as</span> F</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml.stat <span class="im">import</span> Correlation</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml.feature <span class="im">import</span> VectorAssembler,StringIndexer,StandardScaler , PCA</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml.stat <span class="im">import</span> ChiSquareTest</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> f</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objs <span class="im">as</span> go</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml.clustering <span class="im">import</span> KMeans</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml <span class="im">import</span> Pipeline</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="chargement-des-données" class="level2">
<h2 class="anchored" data-anchor-id="chargement-des-données">Chargement des données</h2>
<div id="46d28f16" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># lecture du fichier</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> spark.read<span class="op">\</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    .option(<span class="st">"delimiter"</span>, <span class="st">","</span>)<span class="op">\</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    .option(<span class="st">"header"</span>, <span class="st">"true"</span>)<span class="op">\</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    .option(<span class="st">"inferSchema"</span>, <span class="st">"true"</span>)<span class="op">\</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    .csv(<span class="st">'New_Data.csv'</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>data.printSchema()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>root
 |-- Order ID: integer (nullable = true)
 |-- Product: string (nullable = true)
 |-- Quantity Ordered: integer (nullable = true)
 |-- Price Each: double (nullable = true)
 |-- Order Date: string (nullable = true)
 |-- Purchase Address: string (nullable = true)
</code></pre>
</div>
</div>
<div id="ce0b1123" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>data.show(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>+--------+--------------------+----------------+----------+--------------+--------------------+
|Order ID|             Product|Quantity Ordered|Price Each|    Order Date|    Purchase Address|
+--------+--------------------+----------------+----------+--------------+--------------------+
|  141234|              iPhone|               1|     700.0|01/22/19 21:25|944 Walnut St, Bo...|
|  141235|Lightning Chargin...|               1|     14.95|01/28/19 14:15|185 Maple St, Por...|
|  141236|    Wired Headphones|               2|     11.99|01/17/19 13:33|538 Adams St, San...|
|  141237|    27in FHD Monitor|               1|    149.99|01/05/19 20:33|738 10th St, Los ...|
|  141238|    Wired Headphones|               1|     11.99|01/25/19 11:59|387 10th St, Aust...|
+--------+--------------------+----------------+----------+--------------+--------------------+
only showing top 5 rows
</code></pre>
</div>
</div>
<div id="a7870062" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>data_rdd <span class="op">=</span> data.rdd</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>data_rdd.take(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>[Row(Order ID=141234, Product='iPhone', Quantity Ordered=1, Price Each=700.0, Order Date='01/22/19 21:25', Purchase Address='944 Walnut St, Boston, MA 02215'),
 Row(Order ID=141235, Product='Lightning Charging Cable', Quantity Ordered=1, Price Each=14.95, Order Date='01/28/19 14:15', Purchase Address='185 Maple St, Portland, OR 97035'),
 Row(Order ID=141236, Product='Wired Headphones', Quantity Ordered=2, Price Each=11.99, Order Date='01/17/19 13:33', Purchase Address='538 Adams St, San Francisco, CA 94016'),
 Row(Order ID=141237, Product='27in FHD Monitor', Quantity Ordered=1, Price Each=149.99, Order Date='01/05/19 20:33', Purchase Address='738 10th St, Los Angeles, CA 90001'),
 Row(Order ID=141238, Product='Wired Headphones', Quantity Ordered=1, Price Each=11.99, Order Date='01/25/19 11:59', Purchase Address='387 10th St, Austin, TX 73301')]</code></pre>
</div>
</div>
<div id="5d78457f" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>data.describe().show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>25/01/10 17:28:23 WARN SparkStringUtils: Truncated the string representation of a plan since it was too large. This behavior can be adjusted by setting 'spark.sql.debug.maxToStringFields'.
[Stage 4:&gt;                                                          (0 + 4) / 4]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>+-------+-----------------+------------+------------------+-----------------+--------------+--------------------+
|summary|         Order ID|     Product|  Quantity Ordered|       Price Each|    Order Date|    Purchase Address|
+-------+-----------------+------------+------------------+-----------------+--------------+--------------------+
|  count|           185950|      186304|            185950|           185950|        186304|              186304|
|   mean|230417.5693788653|        NULL|1.1243828986286637|184.3997347674939|          NULL|                NULL|
| stddev|51512.73710999622|        NULL|0.4427926240286705|332.7313298843429|          NULL|                NULL|
|    min|           141234|20in Monitor|                 1|             2.99|01/01/19 03:07|1 11th St, Atlant...|
|    max|           319670|      iPhone|                 9|           1700.0|    Order Date|    Purchase Address|
+-------+-----------------+------------+------------------+-----------------+--------------+--------------------+
</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>                                                                                </code></pre>
</div>
</div>
</section>
<section id="nettoyage-des-données" class="level2">
<h2 class="anchored" data-anchor-id="nettoyage-des-données">Nettoyage des données</h2>
<p>En appliquant ces opérations de nettoyage, nous nous assurons que les données utilisées sont pertinentes et précises, ce qui renforce la fiabilité des résultats de nos futures analyses.</p>
<div id="e1ef1314" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dropna</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.dropna()</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> clean_product_name(product_name):</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> product_name.strip().upper()</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>clean_product_name_udf <span class="op">=</span> udf(clean_product_name, StringType())</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Application de l'UDF pour nettoyer les noms de produits</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.withColumn(<span class="st">"Product"</span>, clean_product_name_udf(data[<span class="st">"Product"</span>]))</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtrer les transactions improbables</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.<span class="bu">filter</span>((data[<span class="st">'`Quantity Ordered`'</span>] <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">&amp;</span> (data[<span class="st">'`Price Each`'</span>] <span class="op">&gt;</span> <span class="dv">0</span>))</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>data_rdd <span class="op">=</span> data.rdd</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="co"># On cache les données nettoyées pour les réutiliser plus tard</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>data.cache()</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>data.show(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>[Stage 7:&gt;                                                          (0 + 4) / 4]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>+--------+--------------------+----------------+----------+--------------+--------------------+
|Order ID|             Product|Quantity Ordered|Price Each|    Order Date|    Purchase Address|
+--------+--------------------+----------------+----------+--------------+--------------------+
|  141234|              IPHONE|               1|     700.0|01/22/19 21:25|944 Walnut St, Bo...|
|  141235|LIGHTNING CHARGIN...|               1|     14.95|01/28/19 14:15|185 Maple St, Por...|
|  141236|    WIRED HEADPHONES|               2|     11.99|01/17/19 13:33|538 Adams St, San...|
|  141237|    27IN FHD MONITOR|               1|    149.99|01/05/19 20:33|738 10th St, Los ...|
|  141238|    WIRED HEADPHONES|               1|     11.99|01/25/19 11:59|387 10th St, Aust...|
+--------+--------------------+----------------+----------+--------------+--------------------+
only showing top 5 rows
</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>                                                                                </code></pre>
</div>
</div>
</section>
<section id="analyse-descriptive" class="level2">
<h2 class="anchored" data-anchor-id="analyse-descriptive">Analyse Descriptive</h2>
<section id="les-10-produits-les-plus-vendus" class="level3">
<h3 class="anchored" data-anchor-id="les-10-produits-les-plus-vendus">Les 10 produits les plus vendus</h3>
<p>Dans un premier temps, l’objectif est de déterminer les produits les plus vendus en regroupant les données par produit et en calculant la somme des quantités commandées pour chacun d’eux. En classant ces produits par ordre décroissant de quantités vendues, nous identifions les dix produits les plus populaires parmi les clients.</p>
<p>Cette analyse est essentielle pour comprendre les préférences des consommateurs et identifier les articles qui génèrent le plus de volume de ventes. En sachant quels produits sont les plus demandés, l’entreprise peut optimiser ses stratégies de stock, ajuster ses campagnes publicitaires pour mettre en avant ces produits, et mieux prévoir les besoins futurs en fonction des tendances de vente.</p>
<p>Les 10 produits les plus vendus sont (sous forme de df) :</p>
<div id="2c6908cf" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Répartition des données sur la colonne "Product" avant les agrégations répétées</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.repartition(<span class="dv">8</span>, <span class="st">"Product"</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Grouper par produit et la somme des quantités</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>top_selling_products <span class="op">=</span> data.groupBy(<span class="st">"Product"</span>).agg(<span class="bu">sum</span>(<span class="st">"`Quantity Ordered`"</span>).alias(<span class="st">"TotalQuantity"</span>))</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co"># print des 10 produits les plus vendus </span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>top_selling_products.orderBy(<span class="st">"TotalQuantity"</span>, ascending<span class="op">=</span><span class="va">False</span>).show(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>+--------------------+-------------+
|             Product|TotalQuantity|
+--------------------+-------------+
|AAA BATTERIES (4-...|        31017|
|AA BATTERIES (4-P...|        27635|
|USB-C CHARGING CABLE|        23975|
|LIGHTNING CHARGIN...|        23217|
|    WIRED HEADPHONES|        20557|
|APPLE AIRPODS HEA...|        15661|
|BOSE SOUNDSPORT H...|        13457|
|    27IN FHD MONITOR|         7550|
|              IPHONE|         6849|
|27IN 4K GAMING MO...|         6244|
+--------------------+-------------+
only showing top 10 rows
</code></pre>
</div>
</div>
<p>Les 10 produits les plus vendus sont (sous forme de rdd) :</p>
<div id="7723fedc" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformation de l'RDD pour extraire les colonnes nécessaires</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>product_quantity_rdd <span class="op">=</span> data_rdd.<span class="bu">map</span>(<span class="kw">lambda</span> row: (row[<span class="st">'Product'</span>], row[<span class="st">'Quantity Ordered'</span>]))</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Agréger les quantités par produit, en gérant les valeurs None</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Si x ou y est None, on le remplace par 0 avant l'addition</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>total_quantity_per_product_rdd <span class="op">=</span> product_quantity_rdd.reduceByKey(<span class="kw">lambda</span> x, y: (x <span class="cf">if</span> x <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="cf">else</span> <span class="dv">0</span>) <span class="op">+</span> (y <span class="cf">if</span> y <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="cf">else</span> <span class="dv">0</span>))</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertir en un RDD de Row pour un affichage facile</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>top_selling_products_rdd <span class="op">=</span> total_quantity_per_product_rdd.<span class="bu">map</span>(<span class="kw">lambda</span> x: Row(Product<span class="op">=</span>x[<span class="dv">0</span>], TotalQuantity<span class="op">=</span>x[<span class="dv">1</span>]))</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Trier les produits par quantité totale commandée en ordre décroissant</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>sorted_top_selling_products_rdd <span class="op">=</span> top_selling_products_rdd.sortBy(<span class="kw">lambda</span> x: x[<span class="st">'TotalQuantity'</span>], ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>sorted_top_selling_products_rdd.take(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>[Stage 12:&gt;                                                         (0 + 4) / 4]                                                                                </code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>[Row(Product='AAA BATTERIES (4-PACK)', TotalQuantity=31017),
 Row(Product='AA BATTERIES (4-PACK)', TotalQuantity=27635),
 Row(Product='USB-C CHARGING CABLE', TotalQuantity=23975),
 Row(Product='LIGHTNING CHARGING CABLE', TotalQuantity=23217),
 Row(Product='WIRED HEADPHONES', TotalQuantity=20557),
 Row(Product='APPLE AIRPODS HEADPHONES', TotalQuantity=15661),
 Row(Product='BOSE SOUNDSPORT HEADPHONES', TotalQuantity=13457),
 Row(Product='27IN FHD MONITOR', TotalQuantity=7550),
 Row(Product='IPHONE', TotalQuantity=6849),
 Row(Product='27IN 4K GAMING MONITOR', TotalQuantity=6244)]</code></pre>
</div>
</div>
</section>
<section id="les-10-produits-les-plus-rentables" class="level3">
<h3 class="anchored" data-anchor-id="les-10-produits-les-plus-rentables">Les 10 produits les plus rentables</h3>
<p>Ici l’objectif est de calculer le revenu total généré par chaque produit en multipliant la quantité commandée par le prix unitaire pour chaque transaction. En regroupant ensuite les données par produit, nous sommes en mesure de déterminer quels sont les produits les plus rentables en termes de revenus générés.</p>
<p>Cette analyse est particulièrement utile pour identifier les produits phares de l’entreprise, c’est-à-dire ceux qui contribuent le plus au chiffre d’affaires. En comprenant quels produits sont les plus rentables, l’entreprise pourra donc optimiser son inventaire, concentrer ses efforts de marketing sur ces produits, et mieux allouer ses ressources pour maximiser les profits. De plus, cette information peut être utilisée pour faire des projections financières et ajuster les stratégies de vente en fonction des performances réelles des produits.</p>
<div id="151313e8" class="cell" data-execution_count="12">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Calculate total revenue for each product</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.withColumn(<span class="st">"Revenue"</span>, col(<span class="st">"Quantity Ordered"</span>) <span class="op">*</span> col(<span class="st">"Price Each"</span>))</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Persistance du DataFrame avec les revenus pour éviter de recalculer</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>data.persist()</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Grouper par  produit et  calcul du revenue total</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>revenue_by_product <span class="op">=</span> data.groupBy(<span class="st">"Product"</span>).agg(<span class="bu">sum</span>(<span class="st">"Revenue"</span>).alias(<span class="st">"TotalRevenue"</span>))</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Les 10 produits les plus rentables sont :"</span>)</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>revenue_by_product.orderBy(<span class="st">"TotalRevenue"</span>, ascending<span class="op">=</span><span class="va">False</span>).show(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Les 10 produits les plus rentables sont :
+--------------------+------------------+
|             Product|      TotalRevenue|
+--------------------+------------------+
|  MACBOOK PRO LAPTOP|         8037600.0|
|              IPHONE|         4794300.0|
|     THINKPAD LAPTOP|4129958.7000004365|
|        GOOGLE PHONE|         3319200.0|
|27IN 4K GAMING MO...|2435097.5600001477|
|34IN ULTRAWIDE MO...|2355558.0100001046|
|APPLE AIRPODS HEA...|         2349150.0|
|       FLATSCREEN TV|         1445700.0|
|BOSE SOUNDSPORT H...|1345565.4299998903|
|    27IN FHD MONITOR|  1132424.49999994|
+--------------------+------------------+
only showing top 10 rows
</code></pre>
</div>
</div>
</section>
<section id="tendance-des-ventes-mensuelles" class="level3">
<h3 class="anchored" data-anchor-id="tendance-des-ventes-mensuelles">Tendance des ventes mensuelles</h3>
<p>En ce qui concerne l’analyse suivante, l’objectif est d’examiner la tendance des ventes mensuelles de l’entreprise en visualisant l’évolution des revenus au fil du temps.</p>
<p>Elle permet de révéler des insights sur le comportement d’achat des clients, aider à identifier les mois les plus rentables, et permettre à l’entreprise de mieux planifier ses stratégies marketing et ses opérations commerciales en fonction des tendances observées. Voir <a href="#fig-lineplot" class="quarto-xref">Figure&nbsp;1</a>.</p>
<div id="bf6dcd9f" class="cell" data-execution_count="13">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Utiliser un udf classique t un pandas_udf</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Définir la fonction pour extraire le mois</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="at">@pandas_udf</span>(IntegerType())</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_month_pandas_udf(order_date: pd.Series) <span class="op">-&gt;</span> pd.Series:</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> order_date.<span class="bu">apply</span>(<span class="kw">lambda</span> date: datetime.strptime(date, <span class="st">'%m/</span><span class="sc">%d</span><span class="st">/%y %H:%M'</span>).month)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Définir la fonction pour extraire l'année</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_year(order_date):</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    date_obj <span class="op">=</span> datetime.strptime(order_date, <span class="st">'%m/</span><span class="sc">%d</span><span class="st">/%y %H:%M'</span>)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> date_obj.year</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>extract_year_udf <span class="op">=</span> udf(extract_year, IntegerType())</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Appliquer les UDFs pour créer les colonnes Month et Year</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.withColumn(<span class="st">"Month"</span>, extract_month_pandas_udf(data[<span class="st">"Order Date"</span>]))</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.withColumn(<span class="st">"Year"</span>, extract_year_udf(data[<span class="st">"Order Date"</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="a016a1fc" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Repartitionner les données avant l'agrégation</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.repartition(<span class="dv">8</span>, <span class="st">"Year"</span>, <span class="st">"Month"</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Grouper par mois et année pour voirs les revenues du mois </span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>monthly_sales <span class="op">=</span> data.groupBy(<span class="st">"Month"</span>, <span class="st">"Year"</span>).agg(<span class="bu">sum</span>(<span class="st">"Revenue"</span>).alias(<span class="st">"TotalRevenue"</span>))</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Show sales trends</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>monthly_sales.orderBy(<span class="st">"Year"</span>, <span class="st">"Month"</span>).show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>[Stage 28:=============================&gt;                            (4 + 4) / 8]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>+-----+----+------------------+
|Month|Year|      TotalRevenue|
+-----+----+------------------+
|    1|2019|1813586.4399999157|
|    2|2019|2202022.4200001857|
|    3|2019|2807100.3800005573|
|    4|2019| 3390670.240000805|
|    5|2019| 3152606.750000683|
|    6|2019|2577802.2600004203|
|    7|2019| 2647775.760000461|
|    8|2019| 2244467.880000234|
|    9|2019|2097560.1299998867|
|   10|2019| 3736726.880001058|
|   11|2019|3199603.2000007546|
|   12|2019| 4613443.340001603|
|    1|2020| 8670.289999999997|
+-----+----+------------------+
</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Stage 28:==================================================&gt;       (7 + 1) / 8]                                                                                </code></pre>
</div>
</div>
<div id="cell-fig-lineplot" class="cell" data-execution_count="15">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertir en DataFrame Pandas</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>monthly_sales_pd <span class="op">=</span> monthly_sales.toPandas()</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Combiner l'année et le mois en une seule colonne pour une meilleure visualisation</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>monthly_sales_pd[<span class="st">'YearMonth'</span>] <span class="op">=</span> monthly_sales_pd[<span class="st">'Year'</span>].astype(<span class="bu">str</span>) <span class="op">+</span> <span class="st">'-'</span> <span class="op">+</span> monthly_sales_pd[<span class="st">'Month'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Configuration du style Seaborn</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>(style<span class="op">=</span><span class="st">"whitegrid"</span>)</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Création du graphique de tendance des ventes mensuelles</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>sns.lineplot(</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>monthly_sales_pd,</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">'YearMonth'</span>,</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">'TotalRevenue'</span>,</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>    marker<span class="op">=</span><span class="st">'o'</span>,</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">'r'</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Configuration des axes et des labels</span></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Tendance des ventes mensuelles'</span>)</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Year-Month'</span>)</span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Revenu total'</span>)</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Affichage du graphique</span></span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-lineplot" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-lineplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="mon_document_files/figure-html/fig-lineplot-output-1.png" width="953" height="563" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-lineplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: lineplot sur l’évolutions des revenus par mois
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="chiffre-daffaires-des-5-principaux-produits-dans-différentes-villes" class="level3">
<h3 class="anchored" data-anchor-id="chiffre-daffaires-des-5-principaux-produits-dans-différentes-villes">Chiffre d’affaires des 5 principaux produits dans différentes villes</h3>
<p>Nous cherchons à identifier les cinq produits les plus rentables, puis d’analyser leur performance en termes de revenus dans différentes villes.</p>
<p>Cette analyse permet de visualiser comment les produits les plus rentables se comportent dans différentes localités, ce qui peut révéler des tendances géographiques dans les préférences des clients. Une telle analyse est cruciale pour adapter les stratégies de vente et de marketing en fonction des régions, optimiser les opérations logistiques, et cibler les efforts commerciaux là où ils sont les plus efficaces. En visualisant ces données à l’aide d’un graphique en barres, nous obtenons un aperçu clair des performances des principaux produits dans les différentes villes. Voir <a href="#fig-barplot" class="quarto-xref">Figure&nbsp;2</a>.</p>
<div id="cell-fig-barplot" class="cell" data-execution_count="16">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtenir les 5 produits les plus rentables</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>top_5_products <span class="op">=</span> revenue_by_product.orderBy(<span class="st">"TotalRevenue"</span>, ascending<span class="op">=</span><span class="va">False</span>).limit(<span class="dv">5</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Récupérer les noms des 5 produits les plus rentables</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>top_5_product_names <span class="op">=</span> [row[<span class="st">'Product'</span>] <span class="cf">for</span> row <span class="kw">in</span> top_5_products.collect()]</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="co"># fonction pour extraire la ville à partir de l'adresse</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_city(purchase_address):</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> purchase_address.split(<span class="st">","</span>)[<span class="dv">1</span>].strip()</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">IndexError</span>:</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span>  <span class="co"># Au cas où le format ne correspondrait pas</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="co"># fonction comme UDF</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>extract_city_udf <span class="op">=</span> udf(extract_city, StringType())</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.withColumn(<span class="st">"City"</span>, extract_city_udf(data[<span class="st">"Purchase Address"</span>]))</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtrer les données pour ne conserver que les 5 produits les plus rentables</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>filtered_data <span class="op">=</span> data.<span class="bu">filter</span>(data[<span class="st">'Product'</span>].isin(top_5_product_names))</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Regrouper par produit et ville pour obtenir le revenu par produit et par ville</span></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>product_city_performance <span class="op">=</span> filtered_data.groupBy(<span class="st">"City"</span>, <span class="st">"Product"</span>).agg(</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">sum</span>(<span class="st">"Revenue"</span>).alias(<span class="st">"TotalRevenue"</span>)</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertir en Pandas pour une analyse plus facile</span></span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>product_city_performance_pd <span class="op">=</span> product_city_performance.orderBy(<span class="st">"City"</span>, <span class="st">"TotalRevenue"</span>, ascending<span class="op">=</span><span class="va">False</span>).toPandas()</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Création du graphique avec Seaborn</span></span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">8</span>))</span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>(style<span class="op">=</span><span class="st">"whitegrid"</span>)</span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Barplot avec Seaborn</span></span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>sns.barplot(</span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>product_city_performance_pd,</span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"City"</span>,</span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">"TotalRevenue"</span>,</span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a>    hue<span class="op">=</span><span class="st">"Product"</span>,</span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a>    palette<span class="op">=</span><span class="st">"tab10"</span></span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-43"><a href="#cb33-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Configuration des axes et des labels</span></span>
<span id="cb33-44"><a href="#cb33-44" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Villes'</span>)</span>
<span id="cb33-45"><a href="#cb33-45" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Revenue Total'</span>)</span>
<span id="cb33-46"><a href="#cb33-46" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Chiffre d'affaires des 5 principaux produits dans différentes villes"</span>)</span>
<span id="cb33-47"><a href="#cb33-47" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb33-48"><a href="#cb33-48" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">'Produits'</span>)</span>
<span id="cb33-49"><a href="#cb33-49" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb33-50"><a href="#cb33-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-51"><a href="#cb33-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Affichage du graphique</span></span>
<span id="cb33-52"><a href="#cb33-52" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-barplot" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-barplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="mon_document_files/figure-html/fig-barplot-output-1.png" width="1122" height="739" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-barplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: barplot sur les revenus des produits les plus rentables par villes
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="analyse-en-composantes-principales-acp" class="level3">
<h3 class="anchored" data-anchor-id="analyse-en-composantes-principales-acp">Analyse en Composantes Principales (ACP)</h3>
<p>Ici, nous appliquons une Analyse en Composantes Principales (ACP) sur notre jeu de données, qui ne contient actuellement que deux colonnes numériques : “Quantity Ordered” et “Price Each”. L’ACP est une technique de réduction de dimensionnalité qui nous permet d’identifier les axes principaux de variation dans les données et de concentrer l’information sur un nombre réduit de composantes. Néanmoins dans un contexte où nous aurions plus de variables numériques, l’ACP serait particulièrement intéressante. Elle nous permettrait didentifier les variables les plus explicatives et d’isoler les dimensions qui capturent la majorité de la variance dans les données.</p>
<div id="52b1d9d3" class="cell" data-execution_count="17">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Étape 1 : Assembler les colonnes numériques en un vecteur</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>numeric_columns <span class="op">=</span> [<span class="st">"Quantity Ordered"</span>, <span class="st">"Price Each"</span>]  </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>assembler <span class="op">=</span> VectorAssembler(inputCols<span class="op">=</span>numeric_columns, outputCol<span class="op">=</span><span class="st">"features"</span>)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Étape 2 : Normaliser les données avec StandardScaler</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler(inputCol<span class="op">=</span><span class="st">"features"</span>, outputCol<span class="op">=</span><span class="st">"scaled_features"</span>, withMean<span class="op">=</span><span class="va">True</span>, withStd<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Étape 3 : Appliquer l'ACP (PCA)</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>pca <span class="op">=</span> PCA(k<span class="op">=</span><span class="dv">2</span>, inputCol<span class="op">=</span><span class="st">"scaled_features"</span>, outputCol<span class="op">=</span><span class="st">"pca_features"</span>)  </span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> Pipeline(stages<span class="op">=</span>[assembler, scaler, pca])</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Entraîner le pipeline</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> pipeline.fit(data)</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformer les données</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>pca_result <span class="op">=</span> model.transform(data)</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>explained_variance <span class="op">=</span> model.stages[<span class="op">-</span><span class="dv">1</span>].explainedVariance  <span class="co"># La dernière étape du pipeline est PCA</span></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Afficher la variance expliquée</span></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Variance expliquée par composante : "</span>, explained_variance)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>[Stage 83:=======&gt;                                                  (1 + 7) / 8]25/01/10 17:28:33 WARN InstanceBuilder: Failed to load implementation from:dev.ludovic.netlib.blas.JNIBLAS
                                                                                25/01/10 17:28:34 WARN InstanceBuilder: Failed to load implementation from:dev.ludovic.netlib.lapack.JNILAPACK</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Variance expliquée par composante :  [0.5741361701727876,0.4258638298272123]</code></pre>
</div>
</div>
<p>La première composante principale (Quantity Ordered) explique 57,41% de la variance, tandis que la deuxième composante principale (Price Each) explique les 42,59% restants. Cela signifie que nos deux variables capturent ensemble toute la variance présente dans les données, même si la première composante est légèrement plus dominante.</p>
</section>
</section>
<section id="tests-statistiques" class="level2">
<h2 class="anchored" data-anchor-id="tests-statistiques">Tests statistiques</h2>
<section id="matrice-de-corrélation" class="level3">
<h3 class="anchored" data-anchor-id="matrice-de-corrélation">Matrice de corrélation</h3>
<p>Pour analyser la relation entre différentes variables numériques dans un jeu de données. En calculant la matrice de corrélation, on peut de déterminer la relation entre les colonnes sélectionnées, ce qui peut aider à identifier des tendances ou des dépendances significatives entre les variables telles que la quantité commandée et le prix unitaire. Voir <a href="#fig-heatmap" class="quarto-xref">Figure&nbsp;3</a>.</p>
<div id="1d7d7b58" class="cell" data-execution_count="18">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_correlation_matrix(df, cols):</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Calcule la matrice de corrélation pour les colonnes spécifiées provenant d'un dataframe</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="co">    df : dataframe.</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="co">    cols (list of str): Liste des noms des colonnes pour lesquelles la corrélation doit être calculée.</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="co">    correlation_matrix: Matrice de corrélation.</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sélection des colonnes pertinentes pour la corrélation</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>    assembler <span class="op">=</span> VectorAssembler(inputCols<span class="op">=</span>cols, outputCol<span class="op">=</span><span class="st">"features"</span>)</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>    vector_data <span class="op">=</span> assembler.transform(df).select(<span class="st">"features"</span>)</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calcul de la matrice de corrélation</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>    correlation_matrix <span class="op">=</span> Correlation.corr(vector_data, <span class="st">"features"</span>).head()[<span class="dv">0</span>]</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> correlation_matrix</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Exemple d'utilisation</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>columns <span class="op">=</span> [<span class="st">"Quantity Ordered"</span>, <span class="st">"Price Each"</span>]</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>correlation_matrix <span class="op">=</span> calculate_correlation_matrix(data, columns)</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Matrice de corrélation :</span><span class="ch">\n</span><span class="st">"</span>, correlation_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Matrice de corrélation :
 DenseMatrix([[ 1.        , -0.14827234],
             [-0.14827234,  1.        ]])</code></pre>
</div>
</div>
<div id="cell-fig-heatmap" class="cell" data-execution_count="19">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertir la matrice de corrélation en un tableau NumPy</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>correlation_matrix_np <span class="op">=</span> correlation_matrix.toArray()</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>sns.heatmap(correlation_matrix_np, annot<span class="op">=</span><span class="va">True</span>, xticklabels<span class="op">=</span>columns, yticklabels<span class="op">=</span>columns, cmap<span class="op">=</span><span class="st">'coolwarm'</span>)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Matrice de Corrélation"</span>)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-heatmap" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-heatmap-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="mon_document_files/figure-html/fig-heatmap-output-1.png" width="540" height="435" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-heatmap-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: heatmap sur la matrice de corrélation
</figcaption>
</figure>
</div>
</div>
</div>
<p>La corrélation légèrement négative entre le prix unitaire et la quantité commandée (-0,148) suggère que les produits plus chers sont généralement achetés en plus petites quantités, bien que cet effet soit faible et que d’autres facteurs puissent influencer les commandes.</p>
</section>
</section>
<section id="test-du-chi-deux" class="level2">
<h2 class="anchored" data-anchor-id="test-du-chi-deux">Test du Chi-deux</h2>
<p>Le test du Chi-deux est un test statistique qui permet de déterminer si deux variables catégorielles sont indépendantes ou non. Dans notre cas, nous allons utiliser ce test pour évaluer si la ville d’achat influence le choix du produit. En d’autres termes, nous voulons savoir si le choix du produit est lié à la ville où il est acheté.</p>
<div id="a2993696" class="cell" data-execution_count="20">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Indexer la colonne catégorielle (par exemple, "Product")</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>product_indexer <span class="op">=</span> StringIndexer(inputCol<span class="op">=</span><span class="st">"Product"</span>, outputCol<span class="op">=</span><span class="st">"ProductIndex"</span>)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>city_indexer <span class="op">=</span> StringIndexer(inputCol<span class="op">=</span><span class="st">"City"</span>, outputCol<span class="op">=</span><span class="st">"CityIndex"</span>)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Assembler les features en un vecteur pour le test</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>assembler <span class="op">=</span> VectorAssembler(inputCols<span class="op">=</span>[<span class="st">"ProductIndex"</span>], outputCol<span class="op">=</span><span class="st">"features"</span>)</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Créer le pipeline</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> Pipeline(stages<span class="op">=</span>[product_indexer,city_indexer, assembler])</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Entraîner le pipeline</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> pipeline.fit(data)</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformer les données</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>transformed_df <span class="op">=</span> model.transform(data)</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Appliquer le test du chi-deux</span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>chi_square_result <span class="op">=</span> ChiSquareTest.test(transformed_df, <span class="st">"features"</span>, <span class="st">"CityIndex"</span>)</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Afficher les résultats</span></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>chi_square_result.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>+--------------------+----------------+-------------------+
|             pValues|degreesOfFreedom|         statistics|
+--------------------+----------------+-------------------+
|[0.4219026900242131]|           [144]|[146.6944498320382]|
+--------------------+----------------+-------------------+
</code></pre>
</div>
</div>
<p>D’après ce test, il n’y a pas de preuve statistique que les ventes de produits dépendent de la ville où elles sont réalisées car nous avons une p-value &gt; 0,05 .</p>
</section>
<section id="machine-learning" class="level2">
<h2 class="anchored" data-anchor-id="machine-learning">Machine Learning</h2>
<section id="clustering" class="level3">
<h3 class="anchored" data-anchor-id="clustering">Clustering</h3>
<p>Ce code réalise une analyse des données de vente d’une entreprise en utilisant PySpark. L’objectif est de regrouper les produits en clusters en fonction de la quantité totale vendue et du prix unitaire moyen, afin d’identifier des tendances et des segments de produits similaires. Voir <a href="#fig-scatterplot" class="quarto-xref">Figure&nbsp;4</a>.</p>
<div id="71c49618" class="cell" data-execution_count="21">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Conversion des colonnes en types numériques</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> data.withColumn(<span class="st">"Quantity Ordered"</span>, col(<span class="st">"Quantity Ordered"</span>).cast(<span class="st">"float"</span>))</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> data.withColumn(<span class="st">"Price Each"</span>, col(<span class="st">"Price Each"</span>).cast(<span class="st">"float"</span>))</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Agrégation des données par produit</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>product_group_df <span class="op">=</span> df.groupBy(<span class="st">"Product"</span>).agg(</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">sum</span>(<span class="st">"Quantity Ordered"</span>).alias(<span class="st">"Total Quantity Ordered"</span>),</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>    mean(<span class="st">"Price Each"</span>).alias(<span class="st">"Price Each"</span>)</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>product_group_df.persist()</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Assembler les features en un vecteur</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>assembler <span class="op">=</span> VectorAssembler(</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>    inputCols<span class="op">=</span>[<span class="st">"Total Quantity Ordered"</span>, <span class="st">"Price Each"</span>],</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>    outputCol<span class="op">=</span><span class="st">"features"</span></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalisation des données</span></span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler(inputCol<span class="op">=</span><span class="st">"features"</span>, outputCol<span class="op">=</span><span class="st">"scaled_features"</span>, withStd<span class="op">=</span><span class="va">True</span>, withMean<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Appliquer KMeans</span></span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>kmeans <span class="op">=</span> KMeans(featuresCol<span class="op">=</span><span class="st">'scaled_features'</span>, k<span class="op">=</span><span class="dv">3</span>, seed<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Définir les étapes du pipeline</span></span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> Pipeline(stages<span class="op">=</span>[assembler, scaler, kmeans])</span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a><span class="co">#Entrainement du model</span></span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> pipeline.fit(product_group_df)</span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a><span class="co">#application du modele</span></span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a>clusters_df <span class="op">=</span> model.transform(product_group_df)</span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Renommer la colonne 'prediction' en 'cluster'</span></span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a>clusters_df <span class="op">=</span> clusters_df.withColumnRenamed(<span class="st">'prediction'</span>, <span class="st">'cluster'</span>)</span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Afficher les résultats</span></span>
<span id="cb42-38"><a href="#cb42-38" aria-hidden="true" tabindex="-1"></a>clusters_df.select(<span class="st">"Product"</span>,<span class="st">"cluster"</span>).show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>+--------------------+-------+
|             Product|cluster|
+--------------------+-------+
|27IN 4K GAMING MO...|      1|
|    WIRED HEADPHONES|      0|
|            LG DRYER|      1|
|USB-C CHARGING CABLE|      0|
|AAA BATTERIES (4-...|      0|
|  LG WASHING MACHINE|      1|
|       FLATSCREEN TV|      1|
|LIGHTNING CHARGIN...|      0|
|34IN ULTRAWIDE MO...|      1|
|              IPHONE|      1|
|        GOOGLE PHONE|      1|
|  MACBOOK PRO LAPTOP|      2|
|BOSE SOUNDSPORT H...|      0|
|APPLE AIRPODS HEA...|      0|
|     THINKPAD LAPTOP|      2|
|     VAREEBADD PHONE|      1|
|AA BATTERIES (4-P...|      0|
|    27IN FHD MONITOR|      1|
|        20IN MONITOR|      1|
+--------------------+-------+
</code></pre>
</div>
</div>
<div id="cell-fig-scatterplot" class="cell" data-execution_count="22">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>result_cluster_pd <span class="op">=</span> clusters_df.toPandas()</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Créer le scatter plot interactif</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.scatter(</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    result_cluster_pd,</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"Total Quantity Ordered"</span>,</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">"Price Each"</span>,</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">"cluster"</span>,</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>    hover_data<span class="op">=</span>[<span class="st">"Product"</span>],  <span class="co"># Affiche le nom du produit lors du survol</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">"Clustering des Produits"</span>,</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>    color_continuous_scale<span class="op">=</span>px.colors.sequential.Bluered</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Afficher la figure</span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-scatterplot" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-scatterplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>                            <div id="3b0c6aaa-f899-4a17-b91a-52f8cdbf6b69" class="plotly-graph-div" style="height:525px; width:100%;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("3b0c6aaa-f899-4a17-b91a-52f8cdbf6b69")) {                    Plotly.newPlot(                        "3b0c6aaa-f899-4a17-b91a-52f8cdbf6b69",                        [{"customdata":[["27IN 4K GAMING MONITOR"],["WIRED HEADPHONES"],["LG DRYER"],["USB-C CHARGING CABLE"],["AAA BATTERIES (4-PACK)"],["LG WASHING MACHINE"],["FLATSCREEN TV"],["LIGHTNING CHARGING CABLE"],["34IN ULTRAWIDE MONITOR"],["IPHONE"],["GOOGLE PHONE"],["MACBOOK PRO LAPTOP"],["BOSE SOUNDSPORT HEADPHONES"],["APPLE AIRPODS HEADPHONES"],["THINKPAD LAPTOP"],["VAREEBADD PHONE"],["AA BATTERIES (4-PACK)"],["27IN FHD MONITOR"],["20IN MONITOR"]],"hovertemplate":"Total Quantity Ordered=%{x}\u003cbr\u003ePrice Each=%{y}\u003cbr\u003eProduct=%{customdata[0]}\u003cbr\u003ecluster=%{marker.color}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"","marker":{"color":[1,0,1,0,0,1,1,0,1,1,1,2,0,0,2,1,0,1,1],"coloraxis":"coloraxis","symbol":"circle"},"mode":"markers","name":"","orientation":"v","showlegend":false,"x":[6244,20557,646,23975,31017,666,4819,23217,6199,6849,5532,4728,13457,15661,4130,2068,27635,7550,4129],"xaxis":"x","y":[389.989990234375,11.989999771118164,600.0,11.949999809265137,2.990000009536743,600.0,300.0,14.949999809265137,379.989990234375,700.0,600.0,1700.0,99.98999786376953,150.0,999.989990234375,400.0,3.8399999141693115,149.99000549316406,109.98999786376953],"yaxis":"y","type":"scatter"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"},"margin":{"b":0,"l":0,"r":0,"t":30}}},"xaxis":{"anchor":"y","domain":[0.0,1.0],"title":{"text":"Total Quantity Ordered"}},"yaxis":{"anchor":"x","domain":[0.0,1.0],"title":{"text":"Price Each"}},"coloraxis":{"colorbar":{"title":{"text":"cluster"}},"colorscale":[[0.0,"rgb(0,0,255)"],[1.0,"rgb(255,0,0)"]]},"legend":{"tracegroupgap":0},"title":{"text":"Clustering des Produits"}},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('3b0c6aaa-f899-4a17-b91a-52f8cdbf6b69');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-scatterplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: scatterplot sur le clustering des produits
</figcaption>
</figure>
</div>
</div>
<div id="a1d30cd3" class="cell" data-execution_count="23">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>clusters_df.groupBy(<span class="st">"cluster"</span>).agg(</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>    F.count(<span class="st">"Product"</span>).alias(<span class="st">"Number of Products"</span>),</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    F.mean(<span class="st">"Price Each"</span>).alias(<span class="st">"Average Price Each"</span>),</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    F.mean(<span class="st">"Total Quantity Ordered"</span>).alias(<span class="st">"Average Quantity Ordered"</span>)</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>).sort(<span class="st">"cluster"</span>).show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>+-------+------------------+------------------+------------------------+
|cluster|Number of Products|Average Price Each|Average Quantity Ordered|
+-------+------------------+------------------+------------------------+
|      0|                 7| 42.24428531101772|                 22217.0|
|      1|                10|422.99599838256836|                  4470.2|
|      2|                 2|1349.9949951171875|                  4429.0|
+-------+------------------+------------------+------------------------+
</code></pre>
</div>
</div>
<p>Nous pouvons aussi utiliser les PCA features pour faire notre cluster, et nous avons les mêmes résultats.</p>
<div id="a9c3e5ea" class="cell" data-execution_count="24">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Appliquer KMeans</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>kmeans <span class="op">=</span> KMeans(featuresCol<span class="op">=</span><span class="st">'pca_features'</span>, k<span class="op">=</span><span class="dv">3</span>, seed<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Définir les étapes du pipeline</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> Pipeline(stages<span class="op">=</span>[kmeans])</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Entrainement du model</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> pipeline.fit(pca_result)</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="co">#application du modele</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>clusters_df_pca <span class="op">=</span> model.transform(pca_result)</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Renommer la colonne 'prediction' en 'cluster'</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>clusters_df_pca <span class="op">=</span> clusters_df.withColumnRenamed(<span class="st">'prediction'</span>, <span class="st">'cluster'</span>)</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Afficher les résultats</span></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>clusters_df_pca.select(<span class="st">"Product"</span>,<span class="st">"cluster"</span>).show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>+--------------------+-------+
|             Product|cluster|
+--------------------+-------+
|27IN 4K GAMING MO...|      1|
|    WIRED HEADPHONES|      0|
|            LG DRYER|      1|
|USB-C CHARGING CABLE|      0|
|AAA BATTERIES (4-...|      0|
|  LG WASHING MACHINE|      1|
|       FLATSCREEN TV|      1|
|LIGHTNING CHARGIN...|      0|
|34IN ULTRAWIDE MO...|      1|
|              IPHONE|      1|
|        GOOGLE PHONE|      1|
|  MACBOOK PRO LAPTOP|      2|
|BOSE SOUNDSPORT H...|      0|
|APPLE AIRPODS HEA...|      0|
|     THINKPAD LAPTOP|      2|
|     VAREEBADD PHONE|      1|
|AA BATTERIES (4-P...|      0|
|    27IN FHD MONITOR|      1|
|        20IN MONITOR|      1|
+--------------------+-------+
</code></pre>
</div>
</div>
</section>
</section>
<section id="flux-de-données-en-temps-réel" class="level2">
<h2 class="anchored" data-anchor-id="flux-de-données-en-temps-réel">Flux de données en temps réel</h2>
<p>Ce code est utile pour effectuer une analyse en temps réel des données reçues via une connexion socket. En utilisant des fenêtres temporelles, il permet d’agréger et de compter les occurrences des mots sur des intervalles de 1 minute. Les résultats sont ensuite sauvegardés dans une table Spark afin d’effectuer des requêtes plus tard.</p>
<p>Adaptée à notre contexte, cette approche permet une réaction en temps réel aux tendances du marché en traitant les données de vente dès leur génération.</p>
<section id="serveur-socket" class="level3">
<h3 class="anchored" data-anchor-id="serveur-socket">Serveur Socket</h3>
<div id="8852b653" class="cell" data-execution_count="25">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> socket</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Configuration du serveur socket</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>server_socket <span class="op">=</span> socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>server_socket.bind((<span class="st">'localhost'</span>, <span class="dv">9999</span>))  <span class="co"># Hôte et port</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>server_socket.listen(<span class="dv">1</span>)  <span class="co"># Permettre une seule connexion client</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Serveur socket en attente de connexion..."</span>)</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>conn, addr <span class="op">=</span> server_socket.accept()  <span class="co"># Accepter la connexion</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Connexion établie avec </span><span class="sc">{</span>addr<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Envoyer des données à intervalles réguliers</span></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>phrases <span class="op">=</span> [<span class="st">'hello world'</span>, <span class="st">'this is a test'</span>, <span class="st">'spark streaming with socke'</span>, <span class="st">'structured streaming example'</span>,<span class="st">'La souris cherche la pomme'</span>, <span class="st">'Le chien déteste le ballon'</span>, <span class="st">'Le chien mange la maison'</span>, <span class="st">'Le professeur construit le jardin'</span>, <span class="st">'Le garçon voit le ballon'</span>, <span class="st">"L'éléphant aime le jardin"</span>, <span class="st">'Le chien voit le travail'</span>, <span class="st">"L'éléphant mange le fromage"</span>, <span class="st">'Le chien déteste le travail'</span>, <span class="st">'La souris enseigne le fromage'</span>, <span class="st">"L'étudiant apprend la musique"</span>, <span class="st">"L'étudiant aime le livre"</span>, <span class="st">'La fille mange le fromage'</span>, <span class="st">"La voiture apprend l'école"</span>, <span class="st">"L'éléphant aime la musique"</span>, <span class="st">"L'étudiant aime le livre"</span>, <span class="st">'La voiture construit le livre'</span>, <span class="st">'La voiture cherche le film'</span>, <span class="st">'La souris aime le fromage'</span>, <span class="st">'La souris détruit le jardin'</span>, <span class="st">"L'oiseau cherche le travail"</span>, <span class="st">'Le professeur cherche le livre'</span>, <span class="st">"Le professeur mange l'école"</span>, <span class="st">"L'étudiant apprend le film"</span>, <span class="st">'La fille voit la maison'</span>, <span class="st">'Le professeur construit le ballon'</span>, <span class="st">"L'étudiant aime le ballon"</span>, <span class="st">"L'oiseau mange la maison"</span>, <span class="st">'Le garçon cherche le film'</span>, <span class="st">"L'éléphant enseigne le film"</span>, <span class="st">'La fille cherche le film'</span>, <span class="st">"L'éléphant détruit le fromage"</span>, <span class="st">'Le garçon apprend la pomme'</span>, <span class="st">'La voiture aime la musique'</span>, <span class="st">"L'éléphant détruit le ballon"</span>, <span class="st">'Le chien mange le film'</span>, <span class="st">'Le professeur déteste le film'</span>, <span class="st">'Le chien déteste le travail'</span>, <span class="st">"L'étudiant détruit le ballon"</span>, <span class="st">"L'éléphant trouve la pomme"</span>, <span class="st">'Le chat construit le livre'</span>, <span class="st">"L'oiseau apprend le jardin"</span>, <span class="st">'La souris aime le jardin'</span>, <span class="st">'Le professeur enseigne le film'</span>, <span class="st">'Le professeur construit le jardin'</span>, <span class="st">'Le chat voit la musique'</span>, <span class="st">"L'étudiant déteste le fromage"</span>, <span class="st">'La voiture apprend la pomme'</span>, <span class="st">"L'étudiant construit la musique"</span>, <span class="st">'Le garçon construit le livre'</span>, <span class="st">'Le chat voit le ballon'</span>, <span class="st">'Le chien construit le travail'</span>, <span class="st">"L'étudiant construit le livre"</span>, <span class="st">"L'éléphant enseigne le film"</span>, <span class="st">"L'étudiant apprend le film"</span>, <span class="st">'Le chat mange la maison'</span>, <span class="st">'La fille construit le fromage'</span>, <span class="st">"L'étudiant mange la maison"</span>, <span class="st">'Le garçon enseigne le jardin'</span>, <span class="st">'Le professeur apprend le fromage'</span>, <span class="st">"Le chien détruit l'école"</span>, <span class="st">"L'étudiant déteste la pomme"</span>, <span class="st">"L'éléphant trouve le travail"</span>, <span class="st">'Le chat apprend le jardin'</span>, <span class="st">'Le professeur mange le jardin'</span>, <span class="st">"L'éléphant déteste la musique"</span>, <span class="st">'La voiture trouve la maison'</span>, <span class="st">'Le professeur détruit la maison'</span>, <span class="st">'Le chat mange la pomme'</span>, <span class="st">'La voiture déteste la pomme'</span>, <span class="st">"L'étudiant enseigne le jardin"</span>, <span class="st">"L'étudiant détruit le film"</span>, <span class="st">'Le chien voit le ballon'</span>, <span class="st">"L'oiseau trouve le film"</span>, <span class="st">"L'oiseau détruit la musique"</span>, <span class="st">"L'éléphant construit le jardin"</span>, <span class="st">"L'éléphant apprend la maison"</span>, <span class="st">'La souris déteste le travail'</span>, <span class="st">'La souris aime la musique'</span>, <span class="st">'La voiture déteste le jardin'</span>, <span class="st">"Le garçon apprend l'école"</span>, <span class="st">"L'éléphant cherche le jardin"</span>, <span class="st">'La souris apprend le travail'</span>, <span class="st">'La fille mange la pomme'</span>, <span class="st">'La souris déteste le fromage'</span>, <span class="st">'La voiture apprend le ballon'</span>, <span class="st">"L'oiseau apprend l'école"</span>, <span class="st">"Le chien enseigne l'école"</span>, <span class="st">'La voiture trouve la pomme'</span>, <span class="st">'Le professeur cherche la musique'</span>, <span class="st">'Le chat trouve la musique'</span>, <span class="st">'La voiture détruit le fromage'</span>, <span class="st">"L'éléphant enseigne le jardin"</span>, <span class="st">"L'oiseau voit le jardin"</span>, <span class="st">"L'éléphant enseigne le livre"</span>, <span class="st">"L'étudiant enseigne le film"</span>, <span class="st">'Le chat détruit le livre'</span>, <span class="st">'Le chat aime le jardin'</span>, <span class="st">'Le chat apprend le livre'</span>, <span class="st">"L'étudiant construit le livre"</span>]</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> text <span class="kw">in</span> phrases:</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>        conn.send((text <span class="op">+</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>).encode())  <span class="co"># Envoyer un message avec un saut de ligne</span></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Envoyé : </span><span class="sc">{</span>text<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>        time.sleep(<span class="dv">2</span>)  <span class="co"># Pause de 2 secondes avant d'envoyer le prochain message</span></span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>conn.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="traitement-des-données-en-temps-réel" class="level3">
<h3 class="anchored" data-anchor-id="traitement-des-données-en-temps-réel">Traitement des données en temps réel</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><embed src="project_streaming.pdf" width="600" height="800"></p>
<figcaption>Code flux in Pyspark</figcaption>
</figure>
</div>
<!-- -->

</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb50" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Projet Big Data"</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Audric Girondin"</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="co">    code-copy: true</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="co">    toc_float:</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="co">      collapse: true</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a><span class="an">jupyter:</span><span class="co"> python3</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduction </span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>Dans un contexte économique de plus en plus compétitif, la capacité d'une entreprise à analyser et exploiter efficacement ses données de vente est cruciale pour maintenir sa position sur le marché. Ce projet s'inscrit dans une démarche d'exploration des ventes d'une entreprise spécialisée dans l'électronique, en utilisant un ensemble de <span class="co">[</span><span class="ot">données</span><span class="co">](https://www.kaggle.com/datasets/darkovichcycy/bd-sales?resource=download&amp;select=Sales_August_2019.csv)</span> provenant de Kaggle. L'objectif principal est d'identifier les produits les plus performants, d'analyser les tendances de vente, et de comprendre les facteurs influençant les revenus.</span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>Ce travail est réalisé dans le cadre de mon cours de Big Data, où j'apprends à gérer et analyser des données massives. L'utilisation de PySpark dans ce projet me permet de manipuler efficacement de grands volumes de données, ce qui est essentiel dans le traitement des données à grande échelle. Le projet comprend plusieurs étapes : le nettoyage des données, des analyses descriptives, des tests statistiques, du machine learning et le traitement de flux. En particulier, le test du Chi-deux a été utilisée pour évaluer s'il y a une dépendance entre la ville et le produit choisi, tandis que le clustering via KMEANS a permis de regrouper certains produits. Sans oublier le traitement des données en flux avec PySpark Streaming, qui permet une analyse en temps réel des données.</span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a><span class="fu">## Configuration</span></span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a><span class="co">#install pyspark</span></span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a><span class="co">#!pip install pyspark</span></span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Spark SQL</span></span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a><span class="co">#!pip install pyspark[sql]</span></span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-34"><a href="#cb50-34" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb50-35"><a href="#cb50-35" aria-hidden="true" tabindex="-1"></a><span class="co">#import google drive</span></span>
<span id="cb50-36"><a href="#cb50-36" aria-hidden="true" tabindex="-1"></a><span class="co">#from google.colab import drive</span></span>
<span id="cb50-37"><a href="#cb50-37" aria-hidden="true" tabindex="-1"></a><span class="co">#drive.mount('/content/drive/')</span></span>
<span id="cb50-38"><a href="#cb50-38" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-39"><a href="#cb50-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-42"><a href="#cb50-42" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb50-43"><a href="#cb50-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Import SparkSession</span></span>
<span id="cb50-44"><a href="#cb50-44" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql <span class="im">import</span> SparkSession</span>
<span id="cb50-45"><a href="#cb50-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a Spark Session</span></span>
<span id="cb50-46"><a href="#cb50-46" aria-hidden="true" tabindex="-1"></a>spark <span class="op">=</span> SparkSession.builder.master(<span class="st">"local[*]"</span>).getOrCreate()</span>
<span id="cb50-47"><a href="#cb50-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Check Spark Session Information</span></span>
<span id="cb50-48"><a href="#cb50-48" aria-hidden="true" tabindex="-1"></a>spark</span>
<span id="cb50-49"><a href="#cb50-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-50"><a href="#cb50-50" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-51"><a href="#cb50-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-52"><a href="#cb50-52" aria-hidden="true" tabindex="-1"></a><span class="fu">## Importation des librairies</span></span>
<span id="cb50-53"><a href="#cb50-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-56"><a href="#cb50-56" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb50-57"><a href="#cb50-57" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql <span class="im">import</span> SparkSession</span>
<span id="cb50-58"><a href="#cb50-58" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql.functions <span class="im">import</span> udf, col, <span class="bu">sum</span>, count, to_date, month, year, split, mean,explode, split, current_timestamp, window, pandas_udf</span>
<span id="cb50-59"><a href="#cb50-59" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql.types <span class="im">import</span> StringType, IntegerType</span>
<span id="cb50-60"><a href="#cb50-60" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql <span class="im">import</span> Row</span>
<span id="cb50-61"><a href="#cb50-61" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb50-62"><a href="#cb50-62" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb50-63"><a href="#cb50-63" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql <span class="im">import</span> functions <span class="im">as</span> F</span>
<span id="cb50-64"><a href="#cb50-64" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb50-65"><a href="#cb50-65" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml.stat <span class="im">import</span> Correlation</span>
<span id="cb50-66"><a href="#cb50-66" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml.feature <span class="im">import</span> VectorAssembler,StringIndexer,StandardScaler , PCA</span>
<span id="cb50-67"><a href="#cb50-67" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml.stat <span class="im">import</span> ChiSquareTest</span>
<span id="cb50-68"><a href="#cb50-68" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> f</span>
<span id="cb50-69"><a href="#cb50-69" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb50-70"><a href="#cb50-70" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb50-71"><a href="#cb50-71" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objs <span class="im">as</span> go</span>
<span id="cb50-72"><a href="#cb50-72" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml.clustering <span class="im">import</span> KMeans</span>
<span id="cb50-73"><a href="#cb50-73" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml <span class="im">import</span> Pipeline</span>
<span id="cb50-74"><a href="#cb50-74" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd </span>
<span id="cb50-75"><a href="#cb50-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-76"><a href="#cb50-76" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-77"><a href="#cb50-77" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chargement des données</span></span>
<span id="cb50-78"><a href="#cb50-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-81"><a href="#cb50-81" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb50-82"><a href="#cb50-82" aria-hidden="true" tabindex="-1"></a><span class="co"># lecture du fichier</span></span>
<span id="cb50-83"><a href="#cb50-83" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> spark.read<span class="op">\</span></span>
<span id="cb50-84"><a href="#cb50-84" aria-hidden="true" tabindex="-1"></a>    .option(<span class="st">"delimiter"</span>, <span class="st">","</span>)<span class="op">\</span></span>
<span id="cb50-85"><a href="#cb50-85" aria-hidden="true" tabindex="-1"></a>    .option(<span class="st">"header"</span>, <span class="st">"true"</span>)<span class="op">\</span></span>
<span id="cb50-86"><a href="#cb50-86" aria-hidden="true" tabindex="-1"></a>    .option(<span class="st">"inferSchema"</span>, <span class="st">"true"</span>)<span class="op">\</span></span>
<span id="cb50-87"><a href="#cb50-87" aria-hidden="true" tabindex="-1"></a>    .csv(<span class="st">'New_Data.csv'</span>)</span>
<span id="cb50-88"><a href="#cb50-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-89"><a href="#cb50-89" aria-hidden="true" tabindex="-1"></a>data.printSchema()</span>
<span id="cb50-90"><a href="#cb50-90" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-91"><a href="#cb50-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-94"><a href="#cb50-94" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb50-95"><a href="#cb50-95" aria-hidden="true" tabindex="-1"></a>data.show(<span class="dv">5</span>)</span>
<span id="cb50-96"><a href="#cb50-96" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-99"><a href="#cb50-99" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb50-100"><a href="#cb50-100" aria-hidden="true" tabindex="-1"></a>data_rdd <span class="op">=</span> data.rdd</span>
<span id="cb50-101"><a href="#cb50-101" aria-hidden="true" tabindex="-1"></a>data_rdd.take(<span class="dv">5</span>)</span>
<span id="cb50-102"><a href="#cb50-102" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-103"><a href="#cb50-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-106"><a href="#cb50-106" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb50-107"><a href="#cb50-107" aria-hidden="true" tabindex="-1"></a>data.describe().show()</span>
<span id="cb50-108"><a href="#cb50-108" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-109"><a href="#cb50-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-110"><a href="#cb50-110" aria-hidden="true" tabindex="-1"></a><span class="fu">## Nettoyage des données</span></span>
<span id="cb50-111"><a href="#cb50-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-112"><a href="#cb50-112" aria-hidden="true" tabindex="-1"></a>En appliquant ces opérations de nettoyage, nous nous assurons que les données utilisées sont pertinentes et précises, ce qui renforce la fiabilité des résultats de nos futures analyses. </span>
<span id="cb50-113"><a href="#cb50-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-116"><a href="#cb50-116" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb50-117"><a href="#cb50-117" aria-hidden="true" tabindex="-1"></a><span class="co"># dropna</span></span>
<span id="cb50-118"><a href="#cb50-118" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.dropna()</span>
<span id="cb50-119"><a href="#cb50-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-120"><a href="#cb50-120" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> clean_product_name(product_name):</span>
<span id="cb50-121"><a href="#cb50-121" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> product_name.strip().upper()</span>
<span id="cb50-122"><a href="#cb50-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-123"><a href="#cb50-123" aria-hidden="true" tabindex="-1"></a>clean_product_name_udf <span class="op">=</span> udf(clean_product_name, StringType())</span>
<span id="cb50-124"><a href="#cb50-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-125"><a href="#cb50-125" aria-hidden="true" tabindex="-1"></a><span class="co"># Application de l'UDF pour nettoyer les noms de produits</span></span>
<span id="cb50-126"><a href="#cb50-126" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.withColumn(<span class="st">"Product"</span>, clean_product_name_udf(data[<span class="st">"Product"</span>]))</span>
<span id="cb50-127"><a href="#cb50-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-128"><a href="#cb50-128" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtrer les transactions improbables</span></span>
<span id="cb50-129"><a href="#cb50-129" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.<span class="bu">filter</span>((data[<span class="st">'`Quantity Ordered`'</span>] <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">&amp;</span> (data[<span class="st">'`Price Each`'</span>] <span class="op">&gt;</span> <span class="dv">0</span>))</span>
<span id="cb50-130"><a href="#cb50-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-131"><a href="#cb50-131" aria-hidden="true" tabindex="-1"></a>data_rdd <span class="op">=</span> data.rdd</span>
<span id="cb50-132"><a href="#cb50-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-133"><a href="#cb50-133" aria-hidden="true" tabindex="-1"></a><span class="co"># On cache les données nettoyées pour les réutiliser plus tard</span></span>
<span id="cb50-134"><a href="#cb50-134" aria-hidden="true" tabindex="-1"></a>data.cache()</span>
<span id="cb50-135"><a href="#cb50-135" aria-hidden="true" tabindex="-1"></a>data.show(<span class="dv">5</span>)</span>
<span id="cb50-136"><a href="#cb50-136" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-137"><a href="#cb50-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-138"><a href="#cb50-138" aria-hidden="true" tabindex="-1"></a><span class="fu">## Analyse Descriptive</span></span>
<span id="cb50-139"><a href="#cb50-139" aria-hidden="true" tabindex="-1"></a><span class="fu">### Les 10 produits les plus vendus</span></span>
<span id="cb50-140"><a href="#cb50-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-141"><a href="#cb50-141" aria-hidden="true" tabindex="-1"></a>Dans un premier temps, l'objectif est de déterminer les produits les plus vendus en regroupant les données par produit et en calculant la somme des quantités commandées pour chacun d'eux. En classant ces produits par ordre décroissant de quantités vendues, nous identifions les dix produits les plus populaires parmi les clients.</span>
<span id="cb50-142"><a href="#cb50-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-143"><a href="#cb50-143" aria-hidden="true" tabindex="-1"></a>Cette analyse est essentielle pour comprendre les préférences des consommateurs et identifier les articles qui génèrent le plus de volume de ventes. En sachant quels produits sont les plus demandés, l'entreprise peut optimiser ses stratégies de stock, ajuster ses campagnes publicitaires pour mettre en avant ces produits, et mieux prévoir les besoins futurs en fonction des tendances de vente. </span>
<span id="cb50-144"><a href="#cb50-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-145"><a href="#cb50-145" aria-hidden="true" tabindex="-1"></a>Les 10 produits les plus vendus sont (sous forme de df) :</span>
<span id="cb50-148"><a href="#cb50-148" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb50-149"><a href="#cb50-149" aria-hidden="true" tabindex="-1"></a><span class="co"># Répartition des données sur la colonne "Product" avant les agrégations répétées</span></span>
<span id="cb50-150"><a href="#cb50-150" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.repartition(<span class="dv">8</span>, <span class="st">"Product"</span>)</span>
<span id="cb50-151"><a href="#cb50-151" aria-hidden="true" tabindex="-1"></a><span class="co"># Grouper par produit et la somme des quantités</span></span>
<span id="cb50-152"><a href="#cb50-152" aria-hidden="true" tabindex="-1"></a>top_selling_products <span class="op">=</span> data.groupBy(<span class="st">"Product"</span>).agg(<span class="bu">sum</span>(<span class="st">"`Quantity Ordered`"</span>).alias(<span class="st">"TotalQuantity"</span>))</span>
<span id="cb50-153"><a href="#cb50-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-154"><a href="#cb50-154" aria-hidden="true" tabindex="-1"></a><span class="co"># print des 10 produits les plus vendus </span></span>
<span id="cb50-155"><a href="#cb50-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-156"><a href="#cb50-156" aria-hidden="true" tabindex="-1"></a>top_selling_products.orderBy(<span class="st">"TotalQuantity"</span>, ascending<span class="op">=</span><span class="va">False</span>).show(<span class="dv">10</span>)</span>
<span id="cb50-157"><a href="#cb50-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-158"><a href="#cb50-158" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-159"><a href="#cb50-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-160"><a href="#cb50-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-161"><a href="#cb50-161" aria-hidden="true" tabindex="-1"></a>Les 10 produits les plus vendus sont (sous forme de rdd) :</span>
<span id="cb50-164"><a href="#cb50-164" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb50-165"><a href="#cb50-165" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformation de l'RDD pour extraire les colonnes nécessaires</span></span>
<span id="cb50-166"><a href="#cb50-166" aria-hidden="true" tabindex="-1"></a>product_quantity_rdd <span class="op">=</span> data_rdd.<span class="bu">map</span>(<span class="kw">lambda</span> row: (row[<span class="st">'Product'</span>], row[<span class="st">'Quantity Ordered'</span>]))</span>
<span id="cb50-167"><a href="#cb50-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-168"><a href="#cb50-168" aria-hidden="true" tabindex="-1"></a><span class="co"># Agréger les quantités par produit, en gérant les valeurs None</span></span>
<span id="cb50-169"><a href="#cb50-169" aria-hidden="true" tabindex="-1"></a><span class="co"># Si x ou y est None, on le remplace par 0 avant l'addition</span></span>
<span id="cb50-170"><a href="#cb50-170" aria-hidden="true" tabindex="-1"></a>total_quantity_per_product_rdd <span class="op">=</span> product_quantity_rdd.reduceByKey(<span class="kw">lambda</span> x, y: (x <span class="cf">if</span> x <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="cf">else</span> <span class="dv">0</span>) <span class="op">+</span> (y <span class="cf">if</span> y <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="cf">else</span> <span class="dv">0</span>))</span>
<span id="cb50-171"><a href="#cb50-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-172"><a href="#cb50-172" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertir en un RDD de Row pour un affichage facile</span></span>
<span id="cb50-173"><a href="#cb50-173" aria-hidden="true" tabindex="-1"></a>top_selling_products_rdd <span class="op">=</span> total_quantity_per_product_rdd.<span class="bu">map</span>(<span class="kw">lambda</span> x: Row(Product<span class="op">=</span>x[<span class="dv">0</span>], TotalQuantity<span class="op">=</span>x[<span class="dv">1</span>]))</span>
<span id="cb50-174"><a href="#cb50-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-175"><a href="#cb50-175" aria-hidden="true" tabindex="-1"></a><span class="co"># Trier les produits par quantité totale commandée en ordre décroissant</span></span>
<span id="cb50-176"><a href="#cb50-176" aria-hidden="true" tabindex="-1"></a>sorted_top_selling_products_rdd <span class="op">=</span> top_selling_products_rdd.sortBy(<span class="kw">lambda</span> x: x[<span class="st">'TotalQuantity'</span>], ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb50-177"><a href="#cb50-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-178"><a href="#cb50-178" aria-hidden="true" tabindex="-1"></a>sorted_top_selling_products_rdd.take(<span class="dv">10</span>)</span>
<span id="cb50-179"><a href="#cb50-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-180"><a href="#cb50-180" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-181"><a href="#cb50-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-182"><a href="#cb50-182" aria-hidden="true" tabindex="-1"></a><span class="fu">### Les 10 produits les plus rentables</span></span>
<span id="cb50-183"><a href="#cb50-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-184"><a href="#cb50-184" aria-hidden="true" tabindex="-1"></a>Ici l'objectif est de calculer le revenu total généré par chaque produit en multipliant la quantité commandée par le prix unitaire pour chaque transaction. En regroupant ensuite les données par produit, nous sommes en mesure de déterminer quels sont les produits les plus rentables en termes de revenus générés.</span>
<span id="cb50-185"><a href="#cb50-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-186"><a href="#cb50-186" aria-hidden="true" tabindex="-1"></a>Cette analyse est particulièrement utile pour identifier les produits phares de l'entreprise, c'est-à-dire ceux qui contribuent le plus au chiffre d'affaires. En comprenant quels produits sont les plus rentables, l'entreprise pourra donc optimiser son inventaire, concentrer ses efforts de marketing sur ces produits, et mieux allouer ses ressources pour maximiser les profits. De plus, cette information peut être utilisée pour faire des projections financières et ajuster les stratégies de vente en fonction des performances réelles des produits.</span>
<span id="cb50-187"><a href="#cb50-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-190"><a href="#cb50-190" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb50-191"><a href="#cb50-191" aria-hidden="true" tabindex="-1"></a><span class="co">#Calculate total revenue for each product</span></span>
<span id="cb50-192"><a href="#cb50-192" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.withColumn(<span class="st">"Revenue"</span>, col(<span class="st">"Quantity Ordered"</span>) <span class="op">*</span> col(<span class="st">"Price Each"</span>))</span>
<span id="cb50-193"><a href="#cb50-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-194"><a href="#cb50-194" aria-hidden="true" tabindex="-1"></a><span class="co"># Persistance du DataFrame avec les revenus pour éviter de recalculer</span></span>
<span id="cb50-195"><a href="#cb50-195" aria-hidden="true" tabindex="-1"></a>data.persist()</span>
<span id="cb50-196"><a href="#cb50-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-197"><a href="#cb50-197" aria-hidden="true" tabindex="-1"></a><span class="co"># Grouper par  produit et  calcul du revenue total</span></span>
<span id="cb50-198"><a href="#cb50-198" aria-hidden="true" tabindex="-1"></a>revenue_by_product <span class="op">=</span> data.groupBy(<span class="st">"Product"</span>).agg(<span class="bu">sum</span>(<span class="st">"Revenue"</span>).alias(<span class="st">"TotalRevenue"</span>))</span>
<span id="cb50-199"><a href="#cb50-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-200"><a href="#cb50-200" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Les 10 produits les plus rentables sont :"</span>)</span>
<span id="cb50-201"><a href="#cb50-201" aria-hidden="true" tabindex="-1"></a>revenue_by_product.orderBy(<span class="st">"TotalRevenue"</span>, ascending<span class="op">=</span><span class="va">False</span>).show(<span class="dv">10</span>)</span>
<span id="cb50-202"><a href="#cb50-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-203"><a href="#cb50-203" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-204"><a href="#cb50-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-205"><a href="#cb50-205" aria-hidden="true" tabindex="-1"></a><span class="fu">### Tendance des ventes mensuelles</span></span>
<span id="cb50-206"><a href="#cb50-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-207"><a href="#cb50-207" aria-hidden="true" tabindex="-1"></a>En ce qui concerne l'analyse suivante, l'objectif est d'examiner la tendance des ventes mensuelles de l'entreprise en visualisant l'évolution des revenus au fil du temps.</span>
<span id="cb50-208"><a href="#cb50-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-209"><a href="#cb50-209" aria-hidden="true" tabindex="-1"></a>Elle permet de révéler des insights sur le comportement d'achat des clients, aider à identifier les mois les plus rentables, et permettre à l'entreprise de mieux planifier ses stratégies marketing et ses opérations commerciales en fonction des tendances observées. Voir @fig-lineplot.</span>
<span id="cb50-210"><a href="#cb50-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-213"><a href="#cb50-213" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb50-214"><a href="#cb50-214" aria-hidden="true" tabindex="-1"></a><span class="co">#Utiliser un udf classique t un pandas_udf</span></span>
<span id="cb50-215"><a href="#cb50-215" aria-hidden="true" tabindex="-1"></a><span class="co"># Définir la fonction pour extraire le mois</span></span>
<span id="cb50-216"><a href="#cb50-216" aria-hidden="true" tabindex="-1"></a><span class="at">@pandas_udf</span>(IntegerType())</span>
<span id="cb50-217"><a href="#cb50-217" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_month_pandas_udf(order_date: pd.Series) <span class="op">-&gt;</span> pd.Series:</span>
<span id="cb50-218"><a href="#cb50-218" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> order_date.<span class="bu">apply</span>(<span class="kw">lambda</span> date: datetime.strptime(date, <span class="st">'%m/</span><span class="sc">%d</span><span class="st">/%y %H:%M'</span>).month)</span>
<span id="cb50-219"><a href="#cb50-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-220"><a href="#cb50-220" aria-hidden="true" tabindex="-1"></a><span class="co"># Définir la fonction pour extraire l'année</span></span>
<span id="cb50-221"><a href="#cb50-221" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_year(order_date):</span>
<span id="cb50-222"><a href="#cb50-222" aria-hidden="true" tabindex="-1"></a>    date_obj <span class="op">=</span> datetime.strptime(order_date, <span class="st">'%m/</span><span class="sc">%d</span><span class="st">/%y %H:%M'</span>)</span>
<span id="cb50-223"><a href="#cb50-223" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> date_obj.year</span>
<span id="cb50-224"><a href="#cb50-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-225"><a href="#cb50-225" aria-hidden="true" tabindex="-1"></a>extract_year_udf <span class="op">=</span> udf(extract_year, IntegerType())</span>
<span id="cb50-226"><a href="#cb50-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-227"><a href="#cb50-227" aria-hidden="true" tabindex="-1"></a><span class="co"># Appliquer les UDFs pour créer les colonnes Month et Year</span></span>
<span id="cb50-228"><a href="#cb50-228" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.withColumn(<span class="st">"Month"</span>, extract_month_pandas_udf(data[<span class="st">"Order Date"</span>]))</span>
<span id="cb50-229"><a href="#cb50-229" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.withColumn(<span class="st">"Year"</span>, extract_year_udf(data[<span class="st">"Order Date"</span>]))</span>
<span id="cb50-230"><a href="#cb50-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-231"><a href="#cb50-231" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-232"><a href="#cb50-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-235"><a href="#cb50-235" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb50-236"><a href="#cb50-236" aria-hidden="true" tabindex="-1"></a><span class="co"># Repartitionner les données avant l'agrégation</span></span>
<span id="cb50-237"><a href="#cb50-237" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.repartition(<span class="dv">8</span>, <span class="st">"Year"</span>, <span class="st">"Month"</span>)</span>
<span id="cb50-238"><a href="#cb50-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-239"><a href="#cb50-239" aria-hidden="true" tabindex="-1"></a><span class="co"># Grouper par mois et année pour voirs les revenues du mois </span></span>
<span id="cb50-240"><a href="#cb50-240" aria-hidden="true" tabindex="-1"></a>monthly_sales <span class="op">=</span> data.groupBy(<span class="st">"Month"</span>, <span class="st">"Year"</span>).agg(<span class="bu">sum</span>(<span class="st">"Revenue"</span>).alias(<span class="st">"TotalRevenue"</span>))</span>
<span id="cb50-241"><a href="#cb50-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-242"><a href="#cb50-242" aria-hidden="true" tabindex="-1"></a><span class="co"># Show sales trends</span></span>
<span id="cb50-243"><a href="#cb50-243" aria-hidden="true" tabindex="-1"></a>monthly_sales.orderBy(<span class="st">"Year"</span>, <span class="st">"Month"</span>).show()</span>
<span id="cb50-244"><a href="#cb50-244" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-245"><a href="#cb50-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-248"><a href="#cb50-248" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb50-249"><a href="#cb50-249" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-lineplot</span></span>
<span id="cb50-250"><a href="#cb50-250" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "lineplot sur l'évolutions des revenus par mois"</span></span>
<span id="cb50-251"><a href="#cb50-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-252"><a href="#cb50-252" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertir en DataFrame Pandas</span></span>
<span id="cb50-253"><a href="#cb50-253" aria-hidden="true" tabindex="-1"></a>monthly_sales_pd <span class="op">=</span> monthly_sales.toPandas()</span>
<span id="cb50-254"><a href="#cb50-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-255"><a href="#cb50-255" aria-hidden="true" tabindex="-1"></a><span class="co"># Combiner l'année et le mois en une seule colonne pour une meilleure visualisation</span></span>
<span id="cb50-256"><a href="#cb50-256" aria-hidden="true" tabindex="-1"></a>monthly_sales_pd[<span class="st">'YearMonth'</span>] <span class="op">=</span> monthly_sales_pd[<span class="st">'Year'</span>].astype(<span class="bu">str</span>) <span class="op">+</span> <span class="st">'-'</span> <span class="op">+</span> monthly_sales_pd[<span class="st">'Month'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb50-257"><a href="#cb50-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-258"><a href="#cb50-258" aria-hidden="true" tabindex="-1"></a><span class="co"># Configuration du style Seaborn</span></span>
<span id="cb50-259"><a href="#cb50-259" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>(style<span class="op">=</span><span class="st">"whitegrid"</span>)</span>
<span id="cb50-260"><a href="#cb50-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-261"><a href="#cb50-261" aria-hidden="true" tabindex="-1"></a><span class="co"># Création du graphique de tendance des ventes mensuelles</span></span>
<span id="cb50-262"><a href="#cb50-262" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb50-263"><a href="#cb50-263" aria-hidden="true" tabindex="-1"></a>sns.lineplot(</span>
<span id="cb50-264"><a href="#cb50-264" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>monthly_sales_pd,</span>
<span id="cb50-265"><a href="#cb50-265" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">'YearMonth'</span>,</span>
<span id="cb50-266"><a href="#cb50-266" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">'TotalRevenue'</span>,</span>
<span id="cb50-267"><a href="#cb50-267" aria-hidden="true" tabindex="-1"></a>    marker<span class="op">=</span><span class="st">'o'</span>,</span>
<span id="cb50-268"><a href="#cb50-268" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">'r'</span></span>
<span id="cb50-269"><a href="#cb50-269" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-270"><a href="#cb50-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-271"><a href="#cb50-271" aria-hidden="true" tabindex="-1"></a><span class="co"># Configuration des axes et des labels</span></span>
<span id="cb50-272"><a href="#cb50-272" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Tendance des ventes mensuelles'</span>)</span>
<span id="cb50-273"><a href="#cb50-273" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Year-Month'</span>)</span>
<span id="cb50-274"><a href="#cb50-274" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Revenu total'</span>)</span>
<span id="cb50-275"><a href="#cb50-275" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb50-276"><a href="#cb50-276" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb50-277"><a href="#cb50-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-278"><a href="#cb50-278" aria-hidden="true" tabindex="-1"></a><span class="co"># Affichage du graphique</span></span>
<span id="cb50-279"><a href="#cb50-279" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb50-280"><a href="#cb50-280" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-281"><a href="#cb50-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-282"><a href="#cb50-282" aria-hidden="true" tabindex="-1"></a><span class="fu">### Chiffre d'affaires des 5 principaux produits dans différentes villes</span></span>
<span id="cb50-283"><a href="#cb50-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-284"><a href="#cb50-284" aria-hidden="true" tabindex="-1"></a>Nous cherchons à identifier les cinq produits les plus rentables, puis d'analyser leur performance en termes de revenus dans différentes villes. </span>
<span id="cb50-285"><a href="#cb50-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-286"><a href="#cb50-286" aria-hidden="true" tabindex="-1"></a>Cette analyse permet de visualiser comment les produits les plus rentables se comportent dans différentes localités, ce qui peut révéler des tendances géographiques dans les préférences des clients. Une telle analyse est cruciale pour adapter les stratégies de vente et de marketing en fonction des régions, optimiser les opérations logistiques, et cibler les efforts commerciaux là où ils sont les plus efficaces. En visualisant ces données à l'aide d'un graphique en barres, nous obtenons un aperçu clair des performances des principaux produits dans les différentes villes. Voir @fig-barplot.</span>
<span id="cb50-287"><a href="#cb50-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-290"><a href="#cb50-290" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb50-291"><a href="#cb50-291" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-barplot</span></span>
<span id="cb50-292"><a href="#cb50-292" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "barplot sur les revenus des produits les plus rentables par villes"</span></span>
<span id="cb50-293"><a href="#cb50-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-294"><a href="#cb50-294" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtenir les 5 produits les plus rentables</span></span>
<span id="cb50-295"><a href="#cb50-295" aria-hidden="true" tabindex="-1"></a>top_5_products <span class="op">=</span> revenue_by_product.orderBy(<span class="st">"TotalRevenue"</span>, ascending<span class="op">=</span><span class="va">False</span>).limit(<span class="dv">5</span>)</span>
<span id="cb50-296"><a href="#cb50-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-297"><a href="#cb50-297" aria-hidden="true" tabindex="-1"></a><span class="co"># Récupérer les noms des 5 produits les plus rentables</span></span>
<span id="cb50-298"><a href="#cb50-298" aria-hidden="true" tabindex="-1"></a>top_5_product_names <span class="op">=</span> [row[<span class="st">'Product'</span>] <span class="cf">for</span> row <span class="kw">in</span> top_5_products.collect()]</span>
<span id="cb50-299"><a href="#cb50-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-300"><a href="#cb50-300" aria-hidden="true" tabindex="-1"></a><span class="co"># fonction pour extraire la ville à partir de l'adresse</span></span>
<span id="cb50-301"><a href="#cb50-301" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_city(purchase_address):</span>
<span id="cb50-302"><a href="#cb50-302" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb50-303"><a href="#cb50-303" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> purchase_address.split(<span class="st">","</span>)[<span class="dv">1</span>].strip()</span>
<span id="cb50-304"><a href="#cb50-304" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">IndexError</span>:</span>
<span id="cb50-305"><a href="#cb50-305" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span>  <span class="co"># Au cas où le format ne correspondrait pas</span></span>
<span id="cb50-306"><a href="#cb50-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-307"><a href="#cb50-307" aria-hidden="true" tabindex="-1"></a><span class="co"># fonction comme UDF</span></span>
<span id="cb50-308"><a href="#cb50-308" aria-hidden="true" tabindex="-1"></a>extract_city_udf <span class="op">=</span> udf(extract_city, StringType())</span>
<span id="cb50-309"><a href="#cb50-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-310"><a href="#cb50-310" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.withColumn(<span class="st">"City"</span>, extract_city_udf(data[<span class="st">"Purchase Address"</span>]))</span>
<span id="cb50-311"><a href="#cb50-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-312"><a href="#cb50-312" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtrer les données pour ne conserver que les 5 produits les plus rentables</span></span>
<span id="cb50-313"><a href="#cb50-313" aria-hidden="true" tabindex="-1"></a>filtered_data <span class="op">=</span> data.<span class="bu">filter</span>(data[<span class="st">'Product'</span>].isin(top_5_product_names))</span>
<span id="cb50-314"><a href="#cb50-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-315"><a href="#cb50-315" aria-hidden="true" tabindex="-1"></a><span class="co"># Regrouper par produit et ville pour obtenir le revenu par produit et par ville</span></span>
<span id="cb50-316"><a href="#cb50-316" aria-hidden="true" tabindex="-1"></a>product_city_performance <span class="op">=</span> filtered_data.groupBy(<span class="st">"City"</span>, <span class="st">"Product"</span>).agg(</span>
<span id="cb50-317"><a href="#cb50-317" aria-hidden="true" tabindex="-1"></a>    <span class="bu">sum</span>(<span class="st">"Revenue"</span>).alias(<span class="st">"TotalRevenue"</span>)</span>
<span id="cb50-318"><a href="#cb50-318" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-319"><a href="#cb50-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-320"><a href="#cb50-320" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertir en Pandas pour une analyse plus facile</span></span>
<span id="cb50-321"><a href="#cb50-321" aria-hidden="true" tabindex="-1"></a>product_city_performance_pd <span class="op">=</span> product_city_performance.orderBy(<span class="st">"City"</span>, <span class="st">"TotalRevenue"</span>, ascending<span class="op">=</span><span class="va">False</span>).toPandas()</span>
<span id="cb50-322"><a href="#cb50-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-323"><a href="#cb50-323" aria-hidden="true" tabindex="-1"></a><span class="co"># Création du graphique avec Seaborn</span></span>
<span id="cb50-324"><a href="#cb50-324" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">8</span>))</span>
<span id="cb50-325"><a href="#cb50-325" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>(style<span class="op">=</span><span class="st">"whitegrid"</span>)</span>
<span id="cb50-326"><a href="#cb50-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-327"><a href="#cb50-327" aria-hidden="true" tabindex="-1"></a><span class="co"># Barplot avec Seaborn</span></span>
<span id="cb50-328"><a href="#cb50-328" aria-hidden="true" tabindex="-1"></a>sns.barplot(</span>
<span id="cb50-329"><a href="#cb50-329" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>product_city_performance_pd,</span>
<span id="cb50-330"><a href="#cb50-330" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"City"</span>,</span>
<span id="cb50-331"><a href="#cb50-331" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">"TotalRevenue"</span>,</span>
<span id="cb50-332"><a href="#cb50-332" aria-hidden="true" tabindex="-1"></a>    hue<span class="op">=</span><span class="st">"Product"</span>,</span>
<span id="cb50-333"><a href="#cb50-333" aria-hidden="true" tabindex="-1"></a>    palette<span class="op">=</span><span class="st">"tab10"</span></span>
<span id="cb50-334"><a href="#cb50-334" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-335"><a href="#cb50-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-336"><a href="#cb50-336" aria-hidden="true" tabindex="-1"></a><span class="co"># Configuration des axes et des labels</span></span>
<span id="cb50-337"><a href="#cb50-337" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Villes'</span>)</span>
<span id="cb50-338"><a href="#cb50-338" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Revenue Total'</span>)</span>
<span id="cb50-339"><a href="#cb50-339" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Chiffre d'affaires des 5 principaux produits dans différentes villes"</span>)</span>
<span id="cb50-340"><a href="#cb50-340" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb50-341"><a href="#cb50-341" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">'Produits'</span>)</span>
<span id="cb50-342"><a href="#cb50-342" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb50-343"><a href="#cb50-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-344"><a href="#cb50-344" aria-hidden="true" tabindex="-1"></a><span class="co"># Affichage du graphique</span></span>
<span id="cb50-345"><a href="#cb50-345" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb50-346"><a href="#cb50-346" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-347"><a href="#cb50-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-348"><a href="#cb50-348" aria-hidden="true" tabindex="-1"></a><span class="fu">### Analyse en Composantes Principales (ACP)</span></span>
<span id="cb50-349"><a href="#cb50-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-350"><a href="#cb50-350" aria-hidden="true" tabindex="-1"></a>Ici, nous appliquons une Analyse en Composantes Principales (ACP) sur notre jeu de données, qui ne contient actuellement que deux colonnes numériques : "Quantity Ordered" et "Price Each". L'ACP est une technique de réduction de dimensionnalité qui nous permet d'identifier les axes principaux de variation dans les données et de concentrer l'information sur un nombre réduit de composantes.</span>
<span id="cb50-351"><a href="#cb50-351" aria-hidden="true" tabindex="-1"></a>Néanmoins dans un contexte où nous aurions plus de variables numériques, l'ACP serait particulièrement intéressante. Elle nous permettrait didentifier les variables les plus explicatives et d'isoler les dimensions qui capturent la majorité de la variance dans les données.</span>
<span id="cb50-352"><a href="#cb50-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-355"><a href="#cb50-355" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb50-356"><a href="#cb50-356" aria-hidden="true" tabindex="-1"></a><span class="co"># Étape 1 : Assembler les colonnes numériques en un vecteur</span></span>
<span id="cb50-357"><a href="#cb50-357" aria-hidden="true" tabindex="-1"></a>numeric_columns <span class="op">=</span> [<span class="st">"Quantity Ordered"</span>, <span class="st">"Price Each"</span>]  </span>
<span id="cb50-358"><a href="#cb50-358" aria-hidden="true" tabindex="-1"></a>assembler <span class="op">=</span> VectorAssembler(inputCols<span class="op">=</span>numeric_columns, outputCol<span class="op">=</span><span class="st">"features"</span>)</span>
<span id="cb50-359"><a href="#cb50-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-360"><a href="#cb50-360" aria-hidden="true" tabindex="-1"></a><span class="co"># Étape 2 : Normaliser les données avec StandardScaler</span></span>
<span id="cb50-361"><a href="#cb50-361" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler(inputCol<span class="op">=</span><span class="st">"features"</span>, outputCol<span class="op">=</span><span class="st">"scaled_features"</span>, withMean<span class="op">=</span><span class="va">True</span>, withStd<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb50-362"><a href="#cb50-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-363"><a href="#cb50-363" aria-hidden="true" tabindex="-1"></a><span class="co"># Étape 3 : Appliquer l'ACP (PCA)</span></span>
<span id="cb50-364"><a href="#cb50-364" aria-hidden="true" tabindex="-1"></a>pca <span class="op">=</span> PCA(k<span class="op">=</span><span class="dv">2</span>, inputCol<span class="op">=</span><span class="st">"scaled_features"</span>, outputCol<span class="op">=</span><span class="st">"pca_features"</span>)  </span>
<span id="cb50-365"><a href="#cb50-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-366"><a href="#cb50-366" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> Pipeline(stages<span class="op">=</span>[assembler, scaler, pca])</span>
<span id="cb50-367"><a href="#cb50-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-368"><a href="#cb50-368" aria-hidden="true" tabindex="-1"></a><span class="co"># Entraîner le pipeline</span></span>
<span id="cb50-369"><a href="#cb50-369" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> pipeline.fit(data)</span>
<span id="cb50-370"><a href="#cb50-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-371"><a href="#cb50-371" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformer les données</span></span>
<span id="cb50-372"><a href="#cb50-372" aria-hidden="true" tabindex="-1"></a>pca_result <span class="op">=</span> model.transform(data)</span>
<span id="cb50-373"><a href="#cb50-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-374"><a href="#cb50-374" aria-hidden="true" tabindex="-1"></a>explained_variance <span class="op">=</span> model.stages[<span class="op">-</span><span class="dv">1</span>].explainedVariance  <span class="co"># La dernière étape du pipeline est PCA</span></span>
<span id="cb50-375"><a href="#cb50-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-376"><a href="#cb50-376" aria-hidden="true" tabindex="-1"></a><span class="co"># Afficher la variance expliquée</span></span>
<span id="cb50-377"><a href="#cb50-377" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Variance expliquée par composante : "</span>, explained_variance)</span>
<span id="cb50-378"><a href="#cb50-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-379"><a href="#cb50-379" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-380"><a href="#cb50-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-381"><a href="#cb50-381" aria-hidden="true" tabindex="-1"></a>La première composante principale (Quantity Ordered) explique 57,41% de la variance, tandis que la deuxième composante principale (Price Each) explique les 42,59% restants. Cela signifie que nos deux variables capturent ensemble toute la variance présente dans les données, même si la première composante est légèrement plus dominante.</span>
<span id="cb50-382"><a href="#cb50-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-383"><a href="#cb50-383" aria-hidden="true" tabindex="-1"></a><span class="fu">## Tests statistiques</span></span>
<span id="cb50-384"><a href="#cb50-384" aria-hidden="true" tabindex="-1"></a><span class="fu">### Matrice de corrélation </span></span>
<span id="cb50-385"><a href="#cb50-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-386"><a href="#cb50-386" aria-hidden="true" tabindex="-1"></a>Pour analyser la relation entre différentes variables numériques dans un jeu de données. En calculant la matrice de corrélation, on peut de déterminer la relation entre les colonnes sélectionnées, ce qui peut aider à identifier des tendances ou des dépendances significatives entre les variables telles que la quantité commandée et le prix unitaire. Voir @fig-heatmap.</span>
<span id="cb50-387"><a href="#cb50-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-390"><a href="#cb50-390" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb50-391"><a href="#cb50-391" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_correlation_matrix(df, cols):</span>
<span id="cb50-392"><a href="#cb50-392" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb50-393"><a href="#cb50-393" aria-hidden="true" tabindex="-1"></a><span class="co">    Calcule la matrice de corrélation pour les colonnes spécifiées provenant d'un dataframe</span></span>
<span id="cb50-394"><a href="#cb50-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-395"><a href="#cb50-395" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb50-396"><a href="#cb50-396" aria-hidden="true" tabindex="-1"></a><span class="co">    df : dataframe.</span></span>
<span id="cb50-397"><a href="#cb50-397" aria-hidden="true" tabindex="-1"></a><span class="co">    cols (list of str): Liste des noms des colonnes pour lesquelles la corrélation doit être calculée.</span></span>
<span id="cb50-398"><a href="#cb50-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-399"><a href="#cb50-399" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb50-400"><a href="#cb50-400" aria-hidden="true" tabindex="-1"></a><span class="co">    correlation_matrix: Matrice de corrélation.</span></span>
<span id="cb50-401"><a href="#cb50-401" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb50-402"><a href="#cb50-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-403"><a href="#cb50-403" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sélection des colonnes pertinentes pour la corrélation</span></span>
<span id="cb50-404"><a href="#cb50-404" aria-hidden="true" tabindex="-1"></a>    assembler <span class="op">=</span> VectorAssembler(inputCols<span class="op">=</span>cols, outputCol<span class="op">=</span><span class="st">"features"</span>)</span>
<span id="cb50-405"><a href="#cb50-405" aria-hidden="true" tabindex="-1"></a>    vector_data <span class="op">=</span> assembler.transform(df).select(<span class="st">"features"</span>)</span>
<span id="cb50-406"><a href="#cb50-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-407"><a href="#cb50-407" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calcul de la matrice de corrélation</span></span>
<span id="cb50-408"><a href="#cb50-408" aria-hidden="true" tabindex="-1"></a>    correlation_matrix <span class="op">=</span> Correlation.corr(vector_data, <span class="st">"features"</span>).head()[<span class="dv">0</span>]</span>
<span id="cb50-409"><a href="#cb50-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-410"><a href="#cb50-410" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> correlation_matrix</span>
<span id="cb50-411"><a href="#cb50-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-412"><a href="#cb50-412" aria-hidden="true" tabindex="-1"></a><span class="co"># Exemple d'utilisation</span></span>
<span id="cb50-413"><a href="#cb50-413" aria-hidden="true" tabindex="-1"></a>columns <span class="op">=</span> [<span class="st">"Quantity Ordered"</span>, <span class="st">"Price Each"</span>]</span>
<span id="cb50-414"><a href="#cb50-414" aria-hidden="true" tabindex="-1"></a>correlation_matrix <span class="op">=</span> calculate_correlation_matrix(data, columns)</span>
<span id="cb50-415"><a href="#cb50-415" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Matrice de corrélation :</span><span class="ch">\n</span><span class="st">"</span>, correlation_matrix)</span>
<span id="cb50-416"><a href="#cb50-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-417"><a href="#cb50-417" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-418"><a href="#cb50-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-421"><a href="#cb50-421" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb50-422"><a href="#cb50-422" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-heatmap</span></span>
<span id="cb50-423"><a href="#cb50-423" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "heatmap sur la matrice de corrélation"</span></span>
<span id="cb50-424"><a href="#cb50-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-425"><a href="#cb50-425" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertir la matrice de corrélation en un tableau NumPy</span></span>
<span id="cb50-426"><a href="#cb50-426" aria-hidden="true" tabindex="-1"></a>correlation_matrix_np <span class="op">=</span> correlation_matrix.toArray()</span>
<span id="cb50-427"><a href="#cb50-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-428"><a href="#cb50-428" aria-hidden="true" tabindex="-1"></a>sns.heatmap(correlation_matrix_np, annot<span class="op">=</span><span class="va">True</span>, xticklabels<span class="op">=</span>columns, yticklabels<span class="op">=</span>columns, cmap<span class="op">=</span><span class="st">'coolwarm'</span>)</span>
<span id="cb50-429"><a href="#cb50-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-430"><a href="#cb50-430" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Matrice de Corrélation"</span>)</span>
<span id="cb50-431"><a href="#cb50-431" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb50-432"><a href="#cb50-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-433"><a href="#cb50-433" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-434"><a href="#cb50-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-435"><a href="#cb50-435" aria-hidden="true" tabindex="-1"></a>La corrélation légèrement négative entre le prix unitaire et la quantité commandée (-0,148) suggère que les produits plus chers sont généralement achetés en plus petites quantités, bien que cet effet soit faible et que d'autres facteurs puissent influencer les commandes.</span>
<span id="cb50-436"><a href="#cb50-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-437"><a href="#cb50-437" aria-hidden="true" tabindex="-1"></a><span class="fu">## Test du Chi-deux</span></span>
<span id="cb50-438"><a href="#cb50-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-439"><a href="#cb50-439" aria-hidden="true" tabindex="-1"></a>Le test du Chi-deux est un test statistique qui permet de déterminer si deux variables catégorielles sont indépendantes ou non. Dans notre cas, nous allons utiliser ce test pour évaluer si la ville d'achat influence le choix du produit. En d'autres termes, nous voulons savoir si le choix du produit est lié à la ville où il est acheté.</span>
<span id="cb50-442"><a href="#cb50-442" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb50-443"><a href="#cb50-443" aria-hidden="true" tabindex="-1"></a><span class="co"># Indexer la colonne catégorielle (par exemple, "Product")</span></span>
<span id="cb50-444"><a href="#cb50-444" aria-hidden="true" tabindex="-1"></a>product_indexer <span class="op">=</span> StringIndexer(inputCol<span class="op">=</span><span class="st">"Product"</span>, outputCol<span class="op">=</span><span class="st">"ProductIndex"</span>)</span>
<span id="cb50-445"><a href="#cb50-445" aria-hidden="true" tabindex="-1"></a>city_indexer <span class="op">=</span> StringIndexer(inputCol<span class="op">=</span><span class="st">"City"</span>, outputCol<span class="op">=</span><span class="st">"CityIndex"</span>)</span>
<span id="cb50-446"><a href="#cb50-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-447"><a href="#cb50-447" aria-hidden="true" tabindex="-1"></a><span class="co"># Assembler les features en un vecteur pour le test</span></span>
<span id="cb50-448"><a href="#cb50-448" aria-hidden="true" tabindex="-1"></a>assembler <span class="op">=</span> VectorAssembler(inputCols<span class="op">=</span>[<span class="st">"ProductIndex"</span>], outputCol<span class="op">=</span><span class="st">"features"</span>)</span>
<span id="cb50-449"><a href="#cb50-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-450"><a href="#cb50-450" aria-hidden="true" tabindex="-1"></a><span class="co"># Créer le pipeline</span></span>
<span id="cb50-451"><a href="#cb50-451" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> Pipeline(stages<span class="op">=</span>[product_indexer,city_indexer, assembler])</span>
<span id="cb50-452"><a href="#cb50-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-453"><a href="#cb50-453" aria-hidden="true" tabindex="-1"></a><span class="co"># Entraîner le pipeline</span></span>
<span id="cb50-454"><a href="#cb50-454" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> pipeline.fit(data)</span>
<span id="cb50-455"><a href="#cb50-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-456"><a href="#cb50-456" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformer les données</span></span>
<span id="cb50-457"><a href="#cb50-457" aria-hidden="true" tabindex="-1"></a>transformed_df <span class="op">=</span> model.transform(data)</span>
<span id="cb50-458"><a href="#cb50-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-459"><a href="#cb50-459" aria-hidden="true" tabindex="-1"></a><span class="co"># Appliquer le test du chi-deux</span></span>
<span id="cb50-460"><a href="#cb50-460" aria-hidden="true" tabindex="-1"></a>chi_square_result <span class="op">=</span> ChiSquareTest.test(transformed_df, <span class="st">"features"</span>, <span class="st">"CityIndex"</span>)</span>
<span id="cb50-461"><a href="#cb50-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-462"><a href="#cb50-462" aria-hidden="true" tabindex="-1"></a><span class="co"># Afficher les résultats</span></span>
<span id="cb50-463"><a href="#cb50-463" aria-hidden="true" tabindex="-1"></a>chi_square_result.show()</span>
<span id="cb50-464"><a href="#cb50-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-465"><a href="#cb50-465" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-466"><a href="#cb50-466" aria-hidden="true" tabindex="-1"></a>D'après ce test, il n'y a pas de preuve statistique que les ventes de produits dépendent de la ville où elles sont réalisées car nous avons une p-value &gt; 0,05 .</span>
<span id="cb50-467"><a href="#cb50-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-468"><a href="#cb50-468" aria-hidden="true" tabindex="-1"></a><span class="fu">## Machine Learning</span></span>
<span id="cb50-469"><a href="#cb50-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-470"><a href="#cb50-470" aria-hidden="true" tabindex="-1"></a><span class="fu">### Clustering </span></span>
<span id="cb50-471"><a href="#cb50-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-472"><a href="#cb50-472" aria-hidden="true" tabindex="-1"></a>Ce code réalise une analyse des données de vente d'une entreprise en utilisant PySpark. L'objectif est de regrouper les produits en clusters en fonction de la quantité totale vendue et du prix unitaire moyen, afin d'identifier des tendances et des segments de produits similaires. Voir @fig-scatterplot.</span>
<span id="cb50-473"><a href="#cb50-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-476"><a href="#cb50-476" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb50-477"><a href="#cb50-477" aria-hidden="true" tabindex="-1"></a><span class="co"># Conversion des colonnes en types numériques</span></span>
<span id="cb50-478"><a href="#cb50-478" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> data.withColumn(<span class="st">"Quantity Ordered"</span>, col(<span class="st">"Quantity Ordered"</span>).cast(<span class="st">"float"</span>))</span>
<span id="cb50-479"><a href="#cb50-479" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> data.withColumn(<span class="st">"Price Each"</span>, col(<span class="st">"Price Each"</span>).cast(<span class="st">"float"</span>))</span>
<span id="cb50-480"><a href="#cb50-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-481"><a href="#cb50-481" aria-hidden="true" tabindex="-1"></a><span class="co"># Agrégation des données par produit</span></span>
<span id="cb50-482"><a href="#cb50-482" aria-hidden="true" tabindex="-1"></a>product_group_df <span class="op">=</span> df.groupBy(<span class="st">"Product"</span>).agg(</span>
<span id="cb50-483"><a href="#cb50-483" aria-hidden="true" tabindex="-1"></a>    <span class="bu">sum</span>(<span class="st">"Quantity Ordered"</span>).alias(<span class="st">"Total Quantity Ordered"</span>),</span>
<span id="cb50-484"><a href="#cb50-484" aria-hidden="true" tabindex="-1"></a>    mean(<span class="st">"Price Each"</span>).alias(<span class="st">"Price Each"</span>)</span>
<span id="cb50-485"><a href="#cb50-485" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-486"><a href="#cb50-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-487"><a href="#cb50-487" aria-hidden="true" tabindex="-1"></a>product_group_df.persist()</span>
<span id="cb50-488"><a href="#cb50-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-489"><a href="#cb50-489" aria-hidden="true" tabindex="-1"></a><span class="co"># Assembler les features en un vecteur</span></span>
<span id="cb50-490"><a href="#cb50-490" aria-hidden="true" tabindex="-1"></a>assembler <span class="op">=</span> VectorAssembler(</span>
<span id="cb50-491"><a href="#cb50-491" aria-hidden="true" tabindex="-1"></a>    inputCols<span class="op">=</span>[<span class="st">"Total Quantity Ordered"</span>, <span class="st">"Price Each"</span>],</span>
<span id="cb50-492"><a href="#cb50-492" aria-hidden="true" tabindex="-1"></a>    outputCol<span class="op">=</span><span class="st">"features"</span></span>
<span id="cb50-493"><a href="#cb50-493" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-494"><a href="#cb50-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-495"><a href="#cb50-495" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalisation des données</span></span>
<span id="cb50-496"><a href="#cb50-496" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler(inputCol<span class="op">=</span><span class="st">"features"</span>, outputCol<span class="op">=</span><span class="st">"scaled_features"</span>, withStd<span class="op">=</span><span class="va">True</span>, withMean<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb50-497"><a href="#cb50-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-498"><a href="#cb50-498" aria-hidden="true" tabindex="-1"></a><span class="co"># Appliquer KMeans</span></span>
<span id="cb50-499"><a href="#cb50-499" aria-hidden="true" tabindex="-1"></a>kmeans <span class="op">=</span> KMeans(featuresCol<span class="op">=</span><span class="st">'scaled_features'</span>, k<span class="op">=</span><span class="dv">3</span>, seed<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb50-500"><a href="#cb50-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-501"><a href="#cb50-501" aria-hidden="true" tabindex="-1"></a><span class="co"># Définir les étapes du pipeline</span></span>
<span id="cb50-502"><a href="#cb50-502" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> Pipeline(stages<span class="op">=</span>[assembler, scaler, kmeans])</span>
<span id="cb50-503"><a href="#cb50-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-504"><a href="#cb50-504" aria-hidden="true" tabindex="-1"></a><span class="co">#Entrainement du model</span></span>
<span id="cb50-505"><a href="#cb50-505" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> pipeline.fit(product_group_df)</span>
<span id="cb50-506"><a href="#cb50-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-507"><a href="#cb50-507" aria-hidden="true" tabindex="-1"></a><span class="co">#application du modele</span></span>
<span id="cb50-508"><a href="#cb50-508" aria-hidden="true" tabindex="-1"></a>clusters_df <span class="op">=</span> model.transform(product_group_df)</span>
<span id="cb50-509"><a href="#cb50-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-510"><a href="#cb50-510" aria-hidden="true" tabindex="-1"></a><span class="co"># Renommer la colonne 'prediction' en 'cluster'</span></span>
<span id="cb50-511"><a href="#cb50-511" aria-hidden="true" tabindex="-1"></a>clusters_df <span class="op">=</span> clusters_df.withColumnRenamed(<span class="st">'prediction'</span>, <span class="st">'cluster'</span>)</span>
<span id="cb50-512"><a href="#cb50-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-513"><a href="#cb50-513" aria-hidden="true" tabindex="-1"></a><span class="co"># Afficher les résultats</span></span>
<span id="cb50-514"><a href="#cb50-514" aria-hidden="true" tabindex="-1"></a>clusters_df.select(<span class="st">"Product"</span>,<span class="st">"cluster"</span>).show()</span>
<span id="cb50-515"><a href="#cb50-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-516"><a href="#cb50-516" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-517"><a href="#cb50-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-520"><a href="#cb50-520" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb50-521"><a href="#cb50-521" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-scatterplot</span></span>
<span id="cb50-522"><a href="#cb50-522" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap : "scatterplot sur le clustering des produits"</span></span>
<span id="cb50-523"><a href="#cb50-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-524"><a href="#cb50-524" aria-hidden="true" tabindex="-1"></a>result_cluster_pd <span class="op">=</span> clusters_df.toPandas()</span>
<span id="cb50-525"><a href="#cb50-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-526"><a href="#cb50-526" aria-hidden="true" tabindex="-1"></a><span class="co"># Créer le scatter plot interactif</span></span>
<span id="cb50-527"><a href="#cb50-527" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.scatter(</span>
<span id="cb50-528"><a href="#cb50-528" aria-hidden="true" tabindex="-1"></a>    result_cluster_pd,</span>
<span id="cb50-529"><a href="#cb50-529" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"Total Quantity Ordered"</span>,</span>
<span id="cb50-530"><a href="#cb50-530" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">"Price Each"</span>,</span>
<span id="cb50-531"><a href="#cb50-531" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">"cluster"</span>,</span>
<span id="cb50-532"><a href="#cb50-532" aria-hidden="true" tabindex="-1"></a>    hover_data<span class="op">=</span>[<span class="st">"Product"</span>],  <span class="co"># Affiche le nom du produit lors du survol</span></span>
<span id="cb50-533"><a href="#cb50-533" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">"Clustering des Produits"</span>,</span>
<span id="cb50-534"><a href="#cb50-534" aria-hidden="true" tabindex="-1"></a>    color_continuous_scale<span class="op">=</span>px.colors.sequential.Bluered</span>
<span id="cb50-535"><a href="#cb50-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-536"><a href="#cb50-536" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-537"><a href="#cb50-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-538"><a href="#cb50-538" aria-hidden="true" tabindex="-1"></a><span class="co"># Afficher la figure</span></span>
<span id="cb50-539"><a href="#cb50-539" aria-hidden="true" tabindex="-1"></a>fig.show()</span>
<span id="cb50-540"><a href="#cb50-540" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-541"><a href="#cb50-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-544"><a href="#cb50-544" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb50-545"><a href="#cb50-545" aria-hidden="true" tabindex="-1"></a>clusters_df.groupBy(<span class="st">"cluster"</span>).agg(</span>
<span id="cb50-546"><a href="#cb50-546" aria-hidden="true" tabindex="-1"></a>    F.count(<span class="st">"Product"</span>).alias(<span class="st">"Number of Products"</span>),</span>
<span id="cb50-547"><a href="#cb50-547" aria-hidden="true" tabindex="-1"></a>    F.mean(<span class="st">"Price Each"</span>).alias(<span class="st">"Average Price Each"</span>),</span>
<span id="cb50-548"><a href="#cb50-548" aria-hidden="true" tabindex="-1"></a>    F.mean(<span class="st">"Total Quantity Ordered"</span>).alias(<span class="st">"Average Quantity Ordered"</span>)</span>
<span id="cb50-549"><a href="#cb50-549" aria-hidden="true" tabindex="-1"></a>).sort(<span class="st">"cluster"</span>).show()</span>
<span id="cb50-550"><a href="#cb50-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-551"><a href="#cb50-551" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-552"><a href="#cb50-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-553"><a href="#cb50-553" aria-hidden="true" tabindex="-1"></a>Nous pouvons aussi utiliser les PCA features pour faire notre cluster, et nous avons les mêmes résultats.</span>
<span id="cb50-556"><a href="#cb50-556" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb50-557"><a href="#cb50-557" aria-hidden="true" tabindex="-1"></a><span class="co"># Appliquer KMeans</span></span>
<span id="cb50-558"><a href="#cb50-558" aria-hidden="true" tabindex="-1"></a>kmeans <span class="op">=</span> KMeans(featuresCol<span class="op">=</span><span class="st">'pca_features'</span>, k<span class="op">=</span><span class="dv">3</span>, seed<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb50-559"><a href="#cb50-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-560"><a href="#cb50-560" aria-hidden="true" tabindex="-1"></a><span class="co"># Définir les étapes du pipeline</span></span>
<span id="cb50-561"><a href="#cb50-561" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> Pipeline(stages<span class="op">=</span>[kmeans])</span>
<span id="cb50-562"><a href="#cb50-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-563"><a href="#cb50-563" aria-hidden="true" tabindex="-1"></a><span class="co">#Entrainement du model</span></span>
<span id="cb50-564"><a href="#cb50-564" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> pipeline.fit(pca_result)</span>
<span id="cb50-565"><a href="#cb50-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-566"><a href="#cb50-566" aria-hidden="true" tabindex="-1"></a><span class="co">#application du modele</span></span>
<span id="cb50-567"><a href="#cb50-567" aria-hidden="true" tabindex="-1"></a>clusters_df_pca <span class="op">=</span> model.transform(pca_result)</span>
<span id="cb50-568"><a href="#cb50-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-569"><a href="#cb50-569" aria-hidden="true" tabindex="-1"></a><span class="co"># Renommer la colonne 'prediction' en 'cluster'</span></span>
<span id="cb50-570"><a href="#cb50-570" aria-hidden="true" tabindex="-1"></a>clusters_df_pca <span class="op">=</span> clusters_df.withColumnRenamed(<span class="st">'prediction'</span>, <span class="st">'cluster'</span>)</span>
<span id="cb50-571"><a href="#cb50-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-572"><a href="#cb50-572" aria-hidden="true" tabindex="-1"></a><span class="co"># Afficher les résultats</span></span>
<span id="cb50-573"><a href="#cb50-573" aria-hidden="true" tabindex="-1"></a>clusters_df_pca.select(<span class="st">"Product"</span>,<span class="st">"cluster"</span>).show()</span>
<span id="cb50-574"><a href="#cb50-574" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-575"><a href="#cb50-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-576"><a href="#cb50-576" aria-hidden="true" tabindex="-1"></a><span class="fu">## Flux de données en temps réel</span></span>
<span id="cb50-577"><a href="#cb50-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-578"><a href="#cb50-578" aria-hidden="true" tabindex="-1"></a>Ce code est utile pour effectuer une analyse en temps réel des données reçues via une connexion socket. En utilisant des fenêtres temporelles, il permet d'agréger et de compter les occurrences des mots sur des intervalles de 1 minute. Les résultats sont ensuite sauvegardés dans une table Spark afin d'effectuer des requêtes plus tard.</span>
<span id="cb50-579"><a href="#cb50-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-580"><a href="#cb50-580" aria-hidden="true" tabindex="-1"></a>Adaptée à notre contexte, cette approche permet une réaction en temps réel aux tendances du marché en traitant les données de vente dès leur génération.</span>
<span id="cb50-581"><a href="#cb50-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-582"><a href="#cb50-582" aria-hidden="true" tabindex="-1"></a><span class="fu">### Serveur Socket</span></span>
<span id="cb50-583"><a href="#cb50-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-586"><a href="#cb50-586" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb50-587"><a href="#cb50-587" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb50-588"><a href="#cb50-588" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> socket</span>
<span id="cb50-589"><a href="#cb50-589" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb50-590"><a href="#cb50-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-591"><a href="#cb50-591" aria-hidden="true" tabindex="-1"></a><span class="co"># Configuration du serveur socket</span></span>
<span id="cb50-592"><a href="#cb50-592" aria-hidden="true" tabindex="-1"></a>server_socket <span class="op">=</span> socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span>
<span id="cb50-593"><a href="#cb50-593" aria-hidden="true" tabindex="-1"></a>server_socket.bind((<span class="st">'localhost'</span>, <span class="dv">9999</span>))  <span class="co"># Hôte et port</span></span>
<span id="cb50-594"><a href="#cb50-594" aria-hidden="true" tabindex="-1"></a>server_socket.listen(<span class="dv">1</span>)  <span class="co"># Permettre une seule connexion client</span></span>
<span id="cb50-595"><a href="#cb50-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-596"><a href="#cb50-596" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Serveur socket en attente de connexion..."</span>)</span>
<span id="cb50-597"><a href="#cb50-597" aria-hidden="true" tabindex="-1"></a>conn, addr <span class="op">=</span> server_socket.accept()  <span class="co"># Accepter la connexion</span></span>
<span id="cb50-598"><a href="#cb50-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-599"><a href="#cb50-599" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Connexion établie avec </span><span class="sc">{</span>addr<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb50-600"><a href="#cb50-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-601"><a href="#cb50-601" aria-hidden="true" tabindex="-1"></a><span class="co"># Envoyer des données à intervalles réguliers</span></span>
<span id="cb50-602"><a href="#cb50-602" aria-hidden="true" tabindex="-1"></a>phrases <span class="op">=</span> [<span class="st">'hello world'</span>, <span class="st">'this is a test'</span>, <span class="st">'spark streaming with socke'</span>, <span class="st">'structured streaming example'</span>,<span class="st">'La souris cherche la pomme'</span>, <span class="st">'Le chien déteste le ballon'</span>, <span class="st">'Le chien mange la maison'</span>, <span class="st">'Le professeur construit le jardin'</span>, <span class="st">'Le garçon voit le ballon'</span>, <span class="st">"L'éléphant aime le jardin"</span>, <span class="st">'Le chien voit le travail'</span>, <span class="st">"L'éléphant mange le fromage"</span>, <span class="st">'Le chien déteste le travail'</span>, <span class="st">'La souris enseigne le fromage'</span>, <span class="st">"L'étudiant apprend la musique"</span>, <span class="st">"L'étudiant aime le livre"</span>, <span class="st">'La fille mange le fromage'</span>, <span class="st">"La voiture apprend l'école"</span>, <span class="st">"L'éléphant aime la musique"</span>, <span class="st">"L'étudiant aime le livre"</span>, <span class="st">'La voiture construit le livre'</span>, <span class="st">'La voiture cherche le film'</span>, <span class="st">'La souris aime le fromage'</span>, <span class="st">'La souris détruit le jardin'</span>, <span class="st">"L'oiseau cherche le travail"</span>, <span class="st">'Le professeur cherche le livre'</span>, <span class="st">"Le professeur mange l'école"</span>, <span class="st">"L'étudiant apprend le film"</span>, <span class="st">'La fille voit la maison'</span>, <span class="st">'Le professeur construit le ballon'</span>, <span class="st">"L'étudiant aime le ballon"</span>, <span class="st">"L'oiseau mange la maison"</span>, <span class="st">'Le garçon cherche le film'</span>, <span class="st">"L'éléphant enseigne le film"</span>, <span class="st">'La fille cherche le film'</span>, <span class="st">"L'éléphant détruit le fromage"</span>, <span class="st">'Le garçon apprend la pomme'</span>, <span class="st">'La voiture aime la musique'</span>, <span class="st">"L'éléphant détruit le ballon"</span>, <span class="st">'Le chien mange le film'</span>, <span class="st">'Le professeur déteste le film'</span>, <span class="st">'Le chien déteste le travail'</span>, <span class="st">"L'étudiant détruit le ballon"</span>, <span class="st">"L'éléphant trouve la pomme"</span>, <span class="st">'Le chat construit le livre'</span>, <span class="st">"L'oiseau apprend le jardin"</span>, <span class="st">'La souris aime le jardin'</span>, <span class="st">'Le professeur enseigne le film'</span>, <span class="st">'Le professeur construit le jardin'</span>, <span class="st">'Le chat voit la musique'</span>, <span class="st">"L'étudiant déteste le fromage"</span>, <span class="st">'La voiture apprend la pomme'</span>, <span class="st">"L'étudiant construit la musique"</span>, <span class="st">'Le garçon construit le livre'</span>, <span class="st">'Le chat voit le ballon'</span>, <span class="st">'Le chien construit le travail'</span>, <span class="st">"L'étudiant construit le livre"</span>, <span class="st">"L'éléphant enseigne le film"</span>, <span class="st">"L'étudiant apprend le film"</span>, <span class="st">'Le chat mange la maison'</span>, <span class="st">'La fille construit le fromage'</span>, <span class="st">"L'étudiant mange la maison"</span>, <span class="st">'Le garçon enseigne le jardin'</span>, <span class="st">'Le professeur apprend le fromage'</span>, <span class="st">"Le chien détruit l'école"</span>, <span class="st">"L'étudiant déteste la pomme"</span>, <span class="st">"L'éléphant trouve le travail"</span>, <span class="st">'Le chat apprend le jardin'</span>, <span class="st">'Le professeur mange le jardin'</span>, <span class="st">"L'éléphant déteste la musique"</span>, <span class="st">'La voiture trouve la maison'</span>, <span class="st">'Le professeur détruit la maison'</span>, <span class="st">'Le chat mange la pomme'</span>, <span class="st">'La voiture déteste la pomme'</span>, <span class="st">"L'étudiant enseigne le jardin"</span>, <span class="st">"L'étudiant détruit le film"</span>, <span class="st">'Le chien voit le ballon'</span>, <span class="st">"L'oiseau trouve le film"</span>, <span class="st">"L'oiseau détruit la musique"</span>, <span class="st">"L'éléphant construit le jardin"</span>, <span class="st">"L'éléphant apprend la maison"</span>, <span class="st">'La souris déteste le travail'</span>, <span class="st">'La souris aime la musique'</span>, <span class="st">'La voiture déteste le jardin'</span>, <span class="st">"Le garçon apprend l'école"</span>, <span class="st">"L'éléphant cherche le jardin"</span>, <span class="st">'La souris apprend le travail'</span>, <span class="st">'La fille mange la pomme'</span>, <span class="st">'La souris déteste le fromage'</span>, <span class="st">'La voiture apprend le ballon'</span>, <span class="st">"L'oiseau apprend l'école"</span>, <span class="st">"Le chien enseigne l'école"</span>, <span class="st">'La voiture trouve la pomme'</span>, <span class="st">'Le professeur cherche la musique'</span>, <span class="st">'Le chat trouve la musique'</span>, <span class="st">'La voiture détruit le fromage'</span>, <span class="st">"L'éléphant enseigne le jardin"</span>, <span class="st">"L'oiseau voit le jardin"</span>, <span class="st">"L'éléphant enseigne le livre"</span>, <span class="st">"L'étudiant enseigne le film"</span>, <span class="st">'Le chat détruit le livre'</span>, <span class="st">'Le chat aime le jardin'</span>, <span class="st">'Le chat apprend le livre'</span>, <span class="st">"L'étudiant construit le livre"</span>]</span>
<span id="cb50-603"><a href="#cb50-603" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb50-604"><a href="#cb50-604" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> text <span class="kw">in</span> phrases:</span>
<span id="cb50-605"><a href="#cb50-605" aria-hidden="true" tabindex="-1"></a>        conn.send((text <span class="op">+</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>).encode())  <span class="co"># Envoyer un message avec un saut de ligne</span></span>
<span id="cb50-606"><a href="#cb50-606" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Envoyé : </span><span class="sc">{</span>text<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb50-607"><a href="#cb50-607" aria-hidden="true" tabindex="-1"></a>        time.sleep(<span class="dv">2</span>)  <span class="co"># Pause de 2 secondes avant d'envoyer le prochain message</span></span>
<span id="cb50-608"><a href="#cb50-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-609"><a href="#cb50-609" aria-hidden="true" tabindex="-1"></a>conn.close()</span>
<span id="cb50-610"><a href="#cb50-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-611"><a href="#cb50-611" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-612"><a href="#cb50-612" aria-hidden="true" tabindex="-1"></a><span class="fu">### Traitement des données en temps réel</span></span>
<span id="cb50-613"><a href="#cb50-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-614"><a href="#cb50-614" aria-hidden="true" tabindex="-1"></a><span class="al">![Code flux in Pyspark](project_streaming.pdf)</span>{ width=600px height=800px }</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>